<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実力判定テスト</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* スタイルは先ほどと同じなので中略しますが、メニューボタン用に追加 */
        body { font-family: sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 650px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; }
        .btn { width: 100%; padding: 15px; border-radius: 8px; border: none; cursor: pointer; font-size: 1.1rem; margin-top: 10px; }
        .btn-blue { background: #007bff; color: white; }
        .btn-gray { background: #6c757d; color: white; }
        .media-box { text-align: center; margin: 15px 0; background: #fafafa; min-height: 200px; display: flex; align-items: center; justify-content: center; }
        img { max-width: 100%; height: auto; }
        iframe { width: 100%; height: 350px; border: none; }
        #result-screen, #judge-screen { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="test-screen">
        <h2 style="text-align:center;">実力判定テスト</h2>
        <div style="text-align:center; color:#666;">第 <span id="current-q-num">1</span> / 13 問</div>
        <div id="q-text" style="margin:20px 0; font-size:1.1rem;"></div>
        <div class="media-box">
            <img id="test-img" style="display:none;">
            <iframe id="test-embed" style="display:none;"></iframe>
        </div>
        <button class="btn btn-blue" onclick="showJudge()">答え合わせをする</button>
    </div>

    <div id="judge-screen">
        <h3 style="color:#d9534f; text-align:center;">正解：<span id="correct-ans"></span></h3>
        <div id="expl-text" style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px;"></div>
        <button class="btn" style="background:#28a745; color:white;" onclick="nextQuestion(true)">正解！</button>
        <button class="btn btn-gray" onclick="nextQuestion(false)">不正解...</button>
    </div>

    <div id="result-screen" style="text-align:center;">
        <h2>テスト結果</h2>
        <div style="font-size:3rem; color:#d9534f; font-weight:bold;"><span id="final-score">0</span> / 13</div>
        <div style="background:#e9ecef; padding:15px; border-radius:10px; margin:20px 0; font-size:1.3rem;">
            推定偏差値: <span id="deviation-value">--</span>
        </div>
        <div id="advice-box" style="text-align:left; border-left:5px solid #007bff; padding-left:15px;"></div>
        <button class="btn btn-blue" onclick="location.reload()">もう一度挑戦</button>
        <button class="btn btn-gray" onclick="location.href='index.html'">メニューに戻る</button>
    </div>
</div>

<script>
// --- ここに MasterDatabase を貼り付け ---
const MasterDatabase = {
    "d1_q1": [
                { q: "$1 - 6 \\times (-2)$", a: "$13$", e: "$1 - (-12) = 13$" },
                { q: "$(-4)^2 \\div 8 - 5$", a: "$-3$", e: "$16 \\div 8 - 5 = 2 - 5 = -3$" },
                { q: "$8a + b - (a - 7b)$", a: "$7a + 8b$", e: "$8a + b - a + 7b = 7a + 8b$" },
                { q: "$(-2)^3 \\times 3 - 4 \\div (-2)$", a: "$-22$", e: "$-24 + 2 = -22$" },
                { q: "$\\frac{3x - y}{2} - \\frac{x - 4y}{4}$", a: "$\\frac{5x + 2y}{4}$", e: "$\\frac{6x-2y-x+4y}{4}$" },
                { q: "$18ab^2 \\div 6b \\times (-2a)$", a: "$-6a^2b$", e: "$3ab \\times (-2a) = -6a^2b$" },
                { q: "$5 + 2 \\times (3 - 8)$", a: "$-5$", e: "$5 - 10 = -5$" },
                { q: "$6x^2 \\div (-3x)^2 \\times 3x$", a: "$2x$", e: "$6x^2 \\div 9x^2 \\times 3x = 2x$" },
                { q: "$9 - (-3)^2 \\div 3$", a: "$6$", e: "$9 - 3 = 6$" },
                { q: "$7 + (-4) - (-9)$", a: "$12$", e: "$7 - 4 + 9 = 12$" },
                { q: "$4(a-b) - 3(2a-b)$", a: "$-2a-b$", e: "$4a-4b-6a+3b$" },
                { q: "$(-3)^2 + 5 \\times (-2)$", a: "$-1$", e: "$9 - 10 = -1$" },
                { q: "$12ab \\div (-4a) \\times 3b$", a: "$-9b^2$", e: "$-3b \\times 3b = -9b^2$" },
                { q: "$2(3x+y) + (x-2y)$", a: "$7x$", e: "$6x+2y+x-2y$" },
                { q: "$(-1)^4 \\times 7 - 8$", a: "$-1$", e: "$1 \\times 7 - 8 = -1$" },
                { q: "$\\frac{1}{3}(6x-9) - 2x$", a: "$-3$", e: "$2x-3-2x = -3$" },
                { q: "$15x^2y \\div 5xy \\times (-2y)$", a: "$-6y^2$", e: "$3x \\times (-2y)$" },
                { q: "$7 - 2^3 \\div 4$", a: "$5$", e: "$7 - 2 = 5$" },
                { q: "$a+2b - \\frac{a-b}{3}$", a: "$\\frac{2a+7b}{3}$", e: "$\\frac{3a+6b-a+b}{3}$" },
                { q: "$(-6)^2 \\div 4 + (-3)$", a: "$6$", e: "$9 - 3 = 6$" }
            ],
            "d1_q2": [
                { q: String.raw`$(\sqrt{3} + 1)^2$`, a: String.raw`$4 + 2\sqrt{3}$`, e: String.raw`$3 + 2\sqrt{3} + 1$` },
                { q: String.raw`$(\sqrt{5} + 2)(\sqrt{5} - 2)$`, a: String.raw`$1$`, e: String.raw`$5 - 4 = 1$` },
                { q: String.raw`$\sqrt{50} - \sqrt{18}$`, a: String.raw`$2\sqrt{2}$`, e: String.raw`$5\sqrt{2} - 3\sqrt{2} = 2\sqrt{2}$` },
                { q: String.raw`$\frac{12}{\sqrt{6}} - \sqrt{24}$`, a: String.raw`$0$`, e: String.raw`$2\sqrt{6} - 2\sqrt{6} = 0$` },
                { q: String.raw`$\sqrt{3} + \frac{6}{\sqrt{3}}$`, a: String.raw`$3\sqrt{3}$`, e: String.raw`$\sqrt{3} + 2\sqrt{3} = 3\sqrt{3}$` },
                { q: String.raw`$(\sqrt{7}-1)(\sqrt{7}+3)$`, a: String.raw`$4+2\sqrt{7}$`, e: String.raw`$7+3\sqrt{7}-\sqrt{7}-3 = 4+2\sqrt{7}$` },
                { q: String.raw`$\sqrt{32} \div \sqrt{2} - \sqrt{9}$`, a: String.raw`$1$`, e: String.raw`$\sqrt{16} - 3 = 4-3=1$` },
                { q: String.raw`$\sqrt{2}(\sqrt{8} + \sqrt{18})$`, a: String.raw`$10$`, e: String.raw`$\sqrt{2}(2\sqrt{2}+3\sqrt{2}) = \sqrt{2} \times 5\sqrt{2} = 10$` },
                { q: String.raw`$(\sqrt{6}+\sqrt{2})(\sqrt{6}-\sqrt{2})$`, a: String.raw`$4$`, e: String.raw`$6-2=4$` },
                { q: String.raw`$\frac{\sqrt{75}}{\sqrt{3}} - \sqrt{4}$`, a: String.raw`$3$`, e: String.raw`$\sqrt{25}-2 = 5-2=3$` },
                { q: String.raw`$(\sqrt{3}-2)^2 + \sqrt{12}$`, a: String.raw`$7-2\sqrt{3}$`, e: String.raw`$3-4\sqrt{3}+4+2\sqrt{3} = 7-2\sqrt{3}$` },
                { q: String.raw`$\sqrt{48} - \frac{9}{\sqrt{3}}$`, a: String.raw`$\sqrt{3}$`, e: String.raw`$4\sqrt{3}-3\sqrt{3} = \sqrt{3}$` },
                { q: String.raw`$(\sqrt{5}+1)^2 - \sqrt{20}$`, a: String.raw`$6$`, e: String.raw`$5+2\sqrt{5}+1-2\sqrt{5} = 6$` },
                { q: String.raw`$\sqrt{27} + \sqrt{12} - \sqrt{75}$`, a: String.raw`$0$`, e: String.raw`$3\sqrt{3}+2\sqrt{3}-5\sqrt{3} = 0$` },
                { q: String.raw`$\frac{10}{\sqrt{5}} + \sqrt{5}$`, a: String.raw`$3\sqrt{5}$`, e: String.raw`$2\sqrt{5}+\sqrt{5} = 3\sqrt{5}$` }
            ],
            "d1_q3": [
                { q: String.raw`$9x - 4 = 5(x + 4)$`, a: String.raw`$x = 6$`, e: String.raw`$9x-4=5x+20 \to 4x=24$` },
                { q: String.raw`$\frac{x-1}{2} - \frac{x+2}{3} = 1$`, a: String.raw`$x = 13$`, e: String.raw`$3(x-1)-2(x+2)=6 \to 3x-3-2x-4=6 \to x=13$` },
                { q: String.raw`$0.3x - 0.1 = 0.5x + 0.7$`, a: String.raw`$x = -4$`, e: String.raw`$3x-1=5x+7 \to -2x=8$` },
                { q: String.raw`$4x - 7 = x + 8$`, a: String.raw`$x = 5$`, e: String.raw`$3x=15 \to x=5$` },
                { q: String.raw`$3(x-2) = 2x + 5$`, a: String.raw`$x = 11$`, e: String.raw`$3x-6=2x+5$` },
                { q: String.raw`$\frac{2}{3}x - 1 = \frac{1}{2}x$`, a: String.raw`$x = 6$`, e: String.raw`$4x-6=3x \to x=6$` },
                { q: String.raw`$5x + 2 = 3(x-4)$`, a: String.raw`$x = -7$`, e: String.raw`$5x+2=3x-12 \to 2x=-14$` },
                { q: String.raw`$x - 8 = 4x + 10$`, a: String.raw`$x = -6$`, e: String.raw`$-3x=18$` },
                { q: String.raw`$0.2x + 1.5 = 0.5x$`, a: String.raw`$x = 5$`, e: String.raw`$2x+15=5x \to 3x=15$` },
                { q: String.raw`$7x - (2x-5) = 15$`, a: String.raw`$x = 2$`, e: String.raw`$5x+5=15 \to 5x=10$` },
                { q: String.raw`$\frac{x+3}{4} = 2$`, a: String.raw`$x = 5$`, e: String.raw`$x+3=8$` },
                { q: String.raw`$8 - x = 3x$`, a: String.raw`$x = 2$`, e: String.raw`$8=4x$` },
                { q: String.raw`$2(x+1) = x-5$`, a: String.raw`$x = -7$`, e: String.raw`$2x+2=x-5$` },
                { q: String.raw`$0.04x = 0.12$`, a: String.raw`$x = 3$`, e: String.raw`$4x=12$` },
                { q: String.raw`$12x - 3 = 7x + 12$`, a: String.raw`$x = 3$`, e: String.raw`$5x=15$` }
            ],
            "d1_q4": [
                { q: String.raw`$\begin{cases} x + 2y = 7 \\ 2x - y = 4 \end{cases}$`, a: String.raw`$x = 3, y = 2$`, e: String.raw`下の式を2倍して足す。` },
                { q: String.raw`$\begin{cases} y = 2x - 1 \\ 3x + 2y = 12 \end{cases}$`, a: String.raw`$x = 2, y = 3$`, e: String.raw`上の式を下の$y$に代入。` },
                { q: String.raw`$\begin{cases} 3x + 2y = 13 \\ x - 2y = 7 \end{cases}$`, a: String.raw`$x = 5, y = -1$`, e: String.raw`そのまま足すと $4x=20$` },
                { q: String.raw`$\begin{cases} 2x + 3y = 8 \\ 2x + y = 4 \end{cases}$`, a: String.raw`$x = 1, y = 2$`, e: String.raw`引くと $2y=4$` },
                { q: String.raw`$\begin{cases} x = 3y \\ 2x - 5y = 1 \end{cases}$`, a: String.raw`$x = 3, y = 1$`, e: String.raw`代入して $6y-5y=1$` },
                { q: String.raw`$\begin{cases} 4x - y = 9 \\ 2x + y = 3 \end{cases}$`, a: String.raw`$x = 2, y = -1$`, e: String.raw`足すと $6x=12$` },
                { q: String.raw`$\begin{cases} x - y = 4 \\ 3x + 2y = 7 \end{cases}$`, a: String.raw`$x = 3, y = -1$`, e: String.raw`上の式を2倍して足す。` },
                { q: String.raw`$\begin{cases} y = x + 2 \\ 2x + y = 8 \end{cases}$`, a: String.raw`$x = 2, y = 4$`, e: String.raw`代入して $3x+2=8$` },
                { q: String.raw`$\begin{cases} 5x + 2y = 1 \\ 3x + y = 1 \end{cases}$`, a: String.raw`$x = 1, y = -2$`, e: String.raw`下の式を2倍して引く。` },
                { q: String.raw`$\begin{cases} x + y = 5 \\ x - y = 1 \end{cases}$`, a: String.raw`$x = 3, y = 2$`, e: String.raw`和と差の基本形。` },
                { q: String.raw`$\begin{cases} 3x - 4y = 10 \\ x = 2y + 4 \end{cases}$`, a: String.raw`$x = 2, y = -1$`, e: String.raw`代入して $3(2y+4)-4y=10 \to 2y=-2$` },
                { q: String.raw`$\begin{cases} 0.2x + 0.3y = 1.3 \\ x - y = -1 \end{cases}$`, a: String.raw`$x = 2, y = 3$`, e: String.raw`上の式を10倍して $2x+3y=13$` },
                { q: String.raw`$\begin{cases} \frac{x}{2} + \frac{y}{3} = 4 \\ x + y = 10 \end{cases}$`, a: String.raw`$x = 4, y = 6$`, e: String.raw`上の式を6倍して $3x+2y=24$` },
                { q: String.raw`$\begin{cases} 7x + 3y = -1 \\ 2x + y = 0 \end{cases}$`, a: String.raw`$x = -1, y = 2$`, e: String.raw`下の式から $y=-2x$ を代入。` },
                { q: String.raw`$\begin{cases} 2x - 3y = 12 \\ 4x + 5y = 2 \end{cases}$`, a: String.raw`$x = 3, y = -2$`, e: String.raw`上の式を2倍して引く。` }
            ],
            "d1_q5": [
                { q: String.raw`$x^2 + 5x + 6 = 0$`, a: String.raw`$x = -2, -3$`, e: String.raw`$(x+2)(x+3)=0$` },
                { q: String.raw`$x^2 - 7x + 10 = 0$`, a: String.raw`$x = 2, 5$`, e: String.raw`$(x-2)(x-5)=0$` },
                { q: String.raw`$x^2 + 2x - 15 = 0$`, a: String.raw`$x = 3, -5$`, e: String.raw`$(x-3)(x+5)=0$` },
                { q: String.raw`$x^2 - 6x + 9 = 0$`, a: String.raw`$x = 3$`, e: String.raw`$(x-3)^2=0$ (重解)` },
                { q: String.raw`$x^2 + 4x = 0$`, a: String.raw`$x = 0, -4$`, e: String.raw`$x(x+4)=0$` },
                { q: String.raw`$x^2 - 16 = 0$`, a: String.raw`$x = \pm 4$`, e: String.raw`$(x-4)(x+4)=0$` },
                { q: String.raw`$x^2 + 3x + 1 = 0$`, a: String.raw`$x = \frac{-3 \pm \sqrt{5}}{2}$`, e: String.raw`解の公式 $x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$` },
                { q: String.raw`$x^2 - 5x + 2 = 0$`, a: String.raw`$x = \frac{5 \pm \sqrt{17}}{2}$`, e: String.raw`解の公式を利用。` },
                { q: String.raw`$2x^2 + 5x + 1 = 0$`, a: String.raw`$x = \frac{-5 \pm \sqrt{17}}{4}$`, e: String.raw`解の公式を利用。` },
                { q: String.raw`$x^2 - 2x - 1 = 0$`, a: String.raw`$x = 1 \pm \sqrt{2}$`, e: String.raw`解の公式より $x = \frac{2 \pm \sqrt{8}}{2} = 1 \pm \sqrt{2}$` },
                { q: String.raw`$3x^2 - 7x + 2 = 0$`, a: String.raw`$x = 2, \frac{1}{3}$`, e: String.raw`$(x-2)(3x-1)=0$ または解の公式。` },
                { q: String.raw`$(x-3)^2 = 5$`, a: String.raw`$x = 3 \pm \sqrt{5}$`, e: String.raw`平方根の考え方を利用。` },
                { q: String.raw`$x^2 + 10x + 25 = 0$`, a: String.raw`$x = -5$`, e: String.raw`$(x+5)^2=0$` },
                { q: String.raw`$x^2 + x - 1 = 0$`, a: String.raw`$x = \frac{-1 \pm \sqrt{5}}{2}$`, e: String.raw`解の公式を利用。` },
                { q: String.raw`$x^2 - 8x + 12 = 0$`, a: String.raw`$x = 2, 6$`, e: String.raw`$(x-2)(x-6)=0$` }
            ],
                "d1_q6": [
        { 
            q: String.raw`関数 $y = 2x^2$ で、$x$ の値が $1$ から $3$ まで増加するときの変化の割合を求めなさい。`, 
            a: String.raw`$8$`, 
            e: String.raw`変化の割合 $= a(x_1 + x_2) = 2(1 + 3) = 8$`,
            img: "assets/graphs/d1_q6_1.png" 
        },
        { 
            q: String.raw`関数 $y = -x^2$ で、$x$ の値が $-4$ から $-2$ まで増加するときの変化の割合を求めなさい。`, 
            a: String.raw`$6$`, 
            e: String.raw`変化の割合 $= -1(-4 + (-2)) = -1(-6) = 6$`,
            img: "assets/graphs/d1_q6_2.png" 
        },
        { 
            q: String.raw`関数 $y = 3x^2$ で、$x$ の変域が $-1 \leqq x \leqq 2$ のときの $y$ の変域を求めなさい。`, 
            a: String.raw`$0 \leqq y \leqq 12$`, 
            e: String.raw`$x=0$ で最小値 $0$、$x=2$ で最大値 $3(2)^2=12$ となります。`,
            img: "assets/graphs/d1_q6_3.png" 
        },
        { 
            q: String.raw`関数 $y = ax^2$ において、$x$ の値が $2$ から $4$ まで増加するときの変化の割合が $12$ であるとき、$a$ の値を求めなさい。`, 
            a: String.raw`$a = 2$`, 
            e: String.raw`$a(2 + 4) = 12$ より $6a = 12 \to a = 2$`,
            img: "assets/graphs/d1_q6_4.png" 
        },
        { 
            q: String.raw`関数 $y = \frac{1}{2}x^2$ で、$x$ の変域が $-4 \leqq x \leqq 2$ のときの $y$ の変域を求めなさい。`, 
            a: String.raw`$0 \leqq y \leqq 8$`, 
            e: String.raw`$x=0$ で最小値 $0$、$x=-4$ で最大値 $\frac{1}{2}(-4)^2=8$ となります。`,
            img: "assets/graphs/d1_q6_5.png" 
        },
        { 
            q: String.raw`関数 $y = -2x^2$ について、$x$ の値が $1$ から $4$ まで増加するときの変化の割合を求めなさい。`, 
            a: String.raw`$-10$`, 
            e: String.raw`変化の割合 $= -2(1 + 4) = -10$`,
            img: "assets/graphs/d1_q6_6.png" 
        },
        { 
            q: String.raw`関数 $y = ax^2$ で、$x$ の変域が $-2 \leqq x \leqq 1$ のとき、$y$ の変域が $0 \leqq y \leqq 8$ となります。$a$ の値を求めなさい。`, 
            a: String.raw`$a = 2$`, 
            e: String.raw`$y$ の最大値が正なので $a>0$。$x=-2$ のとき $y=8$ となるので $a(-2)^2=8 \to 4a=8 \to a=2$`,
            img: "assets/graphs/d1_q6_7.png" 
        },
        { 
            q: String.raw`関数 $y = \frac{1}{4}x^2$ で、$x$ の値が $2$ から $6$ まで増加するときの変化の割合を求めなさい。`, 
            a: String.raw`$2$`, 
            e: String.raw`変化の割合 $= \frac{1}{4}(2 + 6) = \frac{1}{4} \times 8 = 2$`,
            img: "assets/graphs/d1_q6_8.png" 
        },
        { 
            q: String.raw`関数 $y = -3x^2$ で、$x$ の変域が $-1 \leqq x \leqq 3$ のときの $y$ の変域を求めなさい。`, 
            a: String.raw`$-27 \leqq y \leqq 0$`, 
            e: String.raw`$x=3$ のとき最小値 $-3(3)^2 = -27$、$x=0$ で最大値 $0$ となります。`,
            img: "assets/graphs/d1_q6_9.png" 
        },
        { 
            q: String.raw`変化の割合が常に $3$ で、点 $(1, 5)$ を通る直線の式を求めなさい。`, 
            a: String.raw`$y = 3x + 2$`, 
            e: String.raw`$y = 3x + b$ に $(1, 5)$ を代入。 $5 = 3(1) + b \to b = 2$`,
            img: "assets/graphs/d1_q6_10.png" 
        },
        { 
            q: String.raw`関数 $y = x^2$ と $y = 2x + 3$ のグラフの交点の $x$ 座標をすべて求めなさい。`, 
            a: String.raw`$x = 3, -1$`, 
            e: String.raw`$x^2 = 2x + 3 \to x^2 - 2x - 3 = 0 \to (x-3)(x+1) = 0$`,
            img: "assets/graphs/d1_q6_11.png" 
        },
        { 
            q: String.raw`関数 $y = \frac{4}{x}$ で、$x$ の値が $1$ から $4$ まで増加するときの変化の割合を求めなさい。`, 
            a: String.raw`$-1$`, 
            e: String.raw`$x=1$ のとき $y=4$、$x=4$ のとき $y=1$。 変化の割合 $= \frac{1 - 4}{4 - 1} = \frac{-3}{3} = -1$`,
            img: "assets/graphs/d1_q6_12.png" 
        },
        { 
            q: String.raw`関数 $y = -2x^2$ で、$y$ の変域が $-18 \leqq y \leqq 0$ となるような $x$ の変域を求めなさい。`, 
            a: String.raw`$-3 \leqq x \leqq 3$`, 
            e: String.raw`$-2x^2 = -18$ より $x^2 = 9 \to x = \pm 3$。よって変域は $-3 \leqq x \leqq 3$`,
            img: "assets/graphs/d1_q6_13.png" 
        },
        { 
            q: String.raw`関数 $y = ax^2$ と $y = -3x - 1$ について、$x$ の値が $1$ から $3$ まで変化するときの変化の割合が一致するとき、$a$ の値を求めなさい。`, 
            a: String.raw`$a = -0.75$`, 
            e: String.raw`$a(1 + 3) = -3 \to 4a = -3 \to a = -3/4$`,
            img: "assets/graphs/d1_q6_14.png" 
        },
        { 
            q: String.raw`関数 $y = \frac{1}{3}x^2$ について、$x$ の変域が $-3 \leqq x \leqq 6$ のときの $y$ の変域を求めなさい。`, 
            a: String.raw`$0 \leqq y \leqq 12$`, 
            e: String.raw`$x=0$ で最小値 $0$、$x=6$ で最大値 $\frac{1}{3}(6)^2 = 12$ となります。`,
            img: "assets/graphs/d1_q6_15.png" 
        }
    ],

                "d1_q7": [
        { 
            q: String.raw`正九角形の $1$ つの内角の大きさを求めなさい。`, 
            a: String.raw`$140^\circ$`, 
            e: String.raw`外角の和は $360^\circ$ なので、一つの外角は $360 \div 9 = 40^\circ$。内角は $180 - 40 = 140^\circ$。`,
            img: "assets/geometry/d1_q7_1.PNG" 
        },
        { 
            q: String.raw`半径 $6\text{cm}$, 中心角 $120^\circ$ のおうぎ形の弧の長さを求めなさい。`, 
            a: String.raw`$4\pi \text{cm}$`, 
            e: String.raw`$2\pi \times 6 \times \frac{120}{360} = 4\pi$`,
            img: "assets/geometry/d1_q7_2.PNG" 
        },
        { 
            q: String.raw`円周角の定理において、中心角が $80^\circ$ のとき、同じ弧に対する円周角の大きさを求めなさい。`, 
            a: String.raw`$40^\circ$`, 
            e: String.raw`円周角は中心角の半分になります。$80 \div 2 = 40$`,
            img: "assets/geometry/d1_q7_3.PNG" 
        },
        { 
            q: String.raw`$n$ 角形の内角の和が $1260^\circ$ であるとき、$n$ の値を求めなさい。`, 
            a: String.raw`$9$`, 
            e: String.raw`内角の和の公式 $180(n-2) = 1260$ より、$n-2 = 7$。よって $n=9$。`
        },
        { 
            q: String.raw`対角線の本数が $20$ 本である多角形は何角形か答えなさい。`, 
            a: "八角形", 
            e: String.raw`対角線の公式 $\frac{n(n-3)}{2} = 20$ より、$n^2-3n-40=0 \to (n-8)(n+5)=0$。よって $n=8$。`
        },
        { 
            q: String.raw`三角形の $2$ つの内角が $45^\circ, 65^\circ$ のとき、残りの $1$ つの角の外角の大きさを求めなさい。`, 
            a: String.raw`$110^\circ$`, 
            e: String.raw`三角形の外角の性質（他の2つの内角の和に等しい）より、$45 + 65 = 110$。`,
            img: "assets/geometry/d1_q7_6.PNG" 
        },
        { 
            q: String.raw`円に内接する四角形で、向かい合う角の和は何度になるか答えなさい。`, 
            a: String.raw`$180^\circ$`, 
            e: String.raw`円に内接する四角形の性質です。`
        },
        { 
            q: String.raw`中心角 $72^\circ$ のおうぎ形は、円全体の何分の $1$ か求めなさい。`, 
            a: String.raw`$\frac{1}{5}$`, 
            e: String.raw`$\frac{72}{360} = \frac{1}{5}$`,
            img: "assets/geometry/d1_q7_8.PNG" 
        },
        { 
            q: String.raw`正六角形の $1$ つの外角の大きさを求めなさい。`, 
            a: String.raw`$60^\circ$`, 
            e: String.raw`$360 \div 6 = 60$`,
            img: "assets/geometry/d1_q7_9.PNG" 
        },
        { 
            q: String.raw`直角二等辺三角形の鋭角の大きさを求めなさい。`, 
            a: String.raw`$45^\circ$`, 
            e: String.raw`$(180 - 90) \div 2 = 45$`,
            img: "assets/geometry/d1_q7_10.PNG" 
        },
        { 
            q: String.raw`半径 $10\text{cm}$、弧の長さ $4\pi\text{cm}$ のおうぎ形の面積を求めなさい。`, 
            a: String.raw`$20\pi \text{cm}^2$`, 
            e: String.raw`面積 $S = \frac{1}{2}lr = \frac{1}{2} \times 4\pi \times 10 = 20\pi$`,
            img: "assets/geometry/d1_q7_11.PNG" 
        },
        { 
            q: String.raw`対角線の長さが $8\text{cm}$ と $6\text{cm}$ であるひし形の面積を求めなさい。`, 
            a: String.raw`$24 \text{cm}^2$`, 
            e: String.raw`$(8 \times 6) \div 2 = 24$`,
            img: "assets/geometry/d1_q7_12.PNG" 
        },
        { 
            q: String.raw`平行四辺形 $ABCD$ で $\angle A=110^\circ$ のとき、$\angle B$ の大きさを求めなさい。`, 
            a: String.raw`$70^\circ$`, 
            e: String.raw`平行四辺形の隣り合う角の和は $180^\circ$ です。$180 - 110 = 70$`,
            img: "assets/geometry/d1_q7_13.PNG" 
        },
        { 
            q: String.raw`円周上に $3$ 点 $A,B,C$ があり、線分 $AC$ が円の直径であるとき、$\angle ABC$ の大きさを求めなさい。`, 
            a: String.raw`$90^\circ$`, 
            e: String.raw`半円の弧に対する円周角は常に $90^\circ$ です。`,
            img: "assets/geometry/d1_q7_14.PNG" 
        }
    ],

            "d1_q8": [
                { q: String.raw`$2$ 枚の硬貨を同時に投げるとき、少なくとも $1$ 枚が表になる確率。`, a: String.raw`$\frac{3}{4}$`, e: String.raw`「すべて裏」の $1/4$ を $1$ から引く。` },
                { q: String.raw`赤玉 $3$ 個、白玉 $2$ 個が入った袋から同時に $2$ 個取り出すとき、両方赤である確率。`, a: String.raw`$\frac{3}{10}$`, e: String.raw`全部で \${}_5\mathrm{C}_2=10$ 通り。赤 $2$ 個は \${}_3\mathrm{C}_2=3$ 通り。` },
                { q: String.raw`$1$ から $6$ までのカードから $2$ 枚引いて作る $2$ 桁の整数が $3$ の倍数になる確率。`, a: String.raw`$\frac{4}{15}$`, e: String.raw`全 $30$ 通り中、和が $3,6,9$ になる組を探す。` },
                { q: String.raw`サイコロを $2$ 回振り、出た目の積が奇数になる確率。`, a: String.raw`$\frac{1}{4}$`, e: String.raw`$1$ 回目も $2$ 回目も奇数である確率 $(1/2 \times 1/2)$。` },
                { q: String.raw`ある箱の中に白球が多数入っている。黒球を $50$ 個入れて混ぜた後、$40$ 個取り出すと黒球が $2$ 個あった。白球は約何個か。`, a: "約 950 個", e: String.raw`$50 : x = 2 : 40 \to 2x = 2000 \to x=1000$。黒を引いて $950$。` },
                { q: String.raw`トランプ $52$ 枚から $1$ 枚引くとき、絵札（J,Q,K）が出る確率。`, a: String.raw`$\frac{3}{13}$`, e: String.raw`$12/52 = 3/13$` },
                { q: String.raw`$A,B,C$ の $3$ 人でリレーの走る順番を決める方法は何通りか。`, a: "6 通り", e: String.raw`$3 \times 2 \times 1 = 6$` },
                { q: String.raw`くじが $10$ 本あり、$3$ 本が当たり。同時に $2$ 本引いて少なくとも $1$ 本当たる確率。`, a: String.raw`$\frac{8}{15}$`, e: String.raw`余事象（$2$ 本ともハズレ）は \${}_7\mathrm{C}_2 / \${}_{10}\mathrm{C}_2 = 21/45 = 7/15$。$1 - 7/15 = 8/15$。` },
                { q: String.raw`サイコロを振り、$1$ または $6$ の目が出る確率。`, a: String.raw`$\frac{1}{3}$`, e: String.raw`$2/6 = 1/3$` },
                { q: String.raw`袋に $1,2,3,4$ の数字が書かれた玉。元に戻さず $2$ 回引くとき、和が $5$ になる確率。`, a: String.raw`$\frac{1}{3}$`, e: String.raw`全 $12$ 通り. 和が $5$ は $(1,4),(4,1),(2,3),(3,2)$ の $4$ 通り。` },
                { q: String.raw`中央値（メジアン）の意味。`, a: "資料を大きさ順に並べた時の中央の値", e: "データが偶数個の場合は中央の2つの平均。" },
                { q: String.raw`相対度数の合計は必ずいくつになるか。`, a: String.raw`$1$`, e: "各階級の割合の合計なので必ず $1$。" },
                { q: String.raw`最頻値（モード）とは何か。`, a: "最も頻繁に現れる値", e: "度数が最大の階級の階級値など。" },
                { q: String.raw`$5$ 回のテストの平均が $72$ 点。$6$ 回目に何点取れば平均 $75$ 点になるか。`, a: "90 点", e: String.raw`$75 \times 6 - 72 \times 5 = 450 - 360 = 90$` },
                { q: String.raw`$2$ つのサイコロを振り、目の差が $4$ になる確率。`, a: String.raw`$\frac{1}{9}$`, e: String.raw`$(1,5),(2,6),(5,1),(6,2)$ の $4$ 通り。$4/36 = 1/9$` }
            ],
                "d1_q9": [
        { 
            q: String.raw`線分 $AB$ の垂直二等分線を作図しなさい。`, 
            a: "（垂直二等分線の作図）", 
            e: "2点A, Bから等しい半径の弧を描き、その2つの交点を通る直線を引きます。",
            img: "assets/geometry/d1_q9_1.PNG",
            imgA: "assets/geometry/d1_q9_1A.PNG"
        },
        { 
            q: String.raw`$\angle ABC$ の二等分線を作図しなさい。`, 
            a: "（角の二等分線の作図）", 
            e: "頂点Bを中心とする弧を描き、辺との交点からさらに等しい半径の弧を描いて交点を作ります。",
            img: "assets/geometry/d1_q9_2.PNG",
            imgA: "assets/geometry/d1_q9_2A.PNG"
        },
        { 
            q: String.raw`点 $P$ を通り直線 $l$ に垂直な直線を作図しなさい。`, 
            a: "（垂線の作図）", 
            e: "点Pを中心とする弧を描き、直線 $l$ との交点からさらに弧を描いて交点を作ります。",
            img: "assets/geometry/d1_q9_3.PNG",
            imgA: "assets/geometry/d1_q9_3A.PNG"
        },
        { 
            q: String.raw`円の周上の点 $A$ を通る、この円の接線を作図しなさい。`, 
            a: "（接線の作図）", 
            e: "中心 $O$ と点 $A$ を結ぶ半直線を引き、点 $A$ を通る垂線を引きます。",
            img: "assets/geometry/d1_q9_4.PNG",
            imgA: "assets/geometry/d1_q9_4A.PNG"
        },
        { 
            q: String.raw`$3$ 点 $A, B, C$ から等しい距離にある点 $P$ を作図しなさい。`, 
            a: "（外心の作図）", 
            e: "2つの線分（例：ABとBC）の垂直二等分線を引き、その交点を $P$ とします。",
            img: "assets/geometry/d1_q9_5.PNG",
            imgA: "assets/geometry/d1_q9_5A.PNG"
        },
        { 
            q: String.raw`辺 $BC$ を底辺としたときの、$\triangle ABC$ の高さを示す線分を作図しなさい。`, 
            a: "（高さの作図）", 
            e: "点 $A$ から辺 $BC$（またはその延長線）へ下ろした垂線が高さとなります。",
            img: "assets/geometry/d1_q9_6.PNG",
            imgA: "assets/geometry/d1_q9_6A.PNG"
        },
        { 
            q: String.raw`長方形 $ABCD$ を、対角線 $AC$ を軸に折り返したときの頂点 $B$ の移動先 $B'$ を作図しなさい。`, 
            a: "（線対称の作図）", 
            e: "点 $B$ から対角線 $AC$ へ垂線を引き、同じ距離だけ反対側へ伸ばした点が $B'$ です。",
            img: "assets/geometry/d1_q9_7.PNG",
            imgA: "assets/geometry/d1_q9_7A.PNG"
        },
        { 
            q: String.raw`円の中心 $O$ を作図によって求めなさい。`, 
            a: "（円の中心の作図）", 
            e: "円周上の任意の2つの弦について、それぞれの垂直二等分線を引き、その交点を $O$ とします。",
            img: "assets/geometry/d1_q9_8.PNG",
            imgA: "assets/geometry/d1_q9_8A.PNG"
        },
        { 
            q: String.raw`点 $P$ を通り直線 $l$ に平行な直線を作図しなさい。`, 
            a: "（平行線の作図）", 
            e: "点 $P$ を通る垂線を引いた後、その垂線に対して点 $P$ を通る垂線をもう一度引きます。",
            img: "assets/geometry/d1_q9_9.PNG",
            imgA: "assets/geometry/d1_q9_9A.PNG"
        },
        { 
            q: String.raw`$60^\circ$ の角度を作図しなさい。`, 
            a: "（正三角形の利用）", 
            e: "1つの線分を1辺とする正三角形を描くと、その内角はすべて $60^\circ$ になります。",
            img: "assets/geometry/d1_q9_10.PNG",
            imgA: "assets/geometry/d1_q9_10A.PNG"
        },
        { 
            q: String.raw`$30^\circ$ の角度を作図しなさい。`, 
            a: "（60度の二等分）", 
            e: "まず $60^\circ$ を作図し、その角の二等分線を引くことで $30^\circ$ を作ります。",
            img: "assets/geometry/d1_q9_11.PNG",
            imgA: "assets/geometry/d1_q9_11A.PNG"
        },
        { 
            q: String.raw`線分 $AB$ を $1:3$ に分ける点を作図しなさい。`, 
            a: "（垂直二等分線の繰り返し）", 
            e: "線分 $AB$ の垂直二等分線で2等分し、さらに $A$ 側の線分を二等分することで $1:3$ の点を作ります。",
            img: "assets/geometry/d1_q9_12.PNG",
            imgA: "assets/geometry/d1_q9_12A.PNG"
        },
        { 
            q: String.raw`辺 $AB$ 上にあり、辺 $AC, BC$ から等しい距離にある点を作図しなさい。`, 
            a: "（角の二等分線と辺の交点）", 
            e: "$\angle C$ の二等分線を引き、辺 $AB$ との交点を求めます。",
            img: "assets/geometry/d1_q9_13.PNG",
            imgA: "assets/geometry/d1_q9_13A.PNG"
        },
        { 
            q: String.raw`円の外の点 $P$ から、この円への接線を作図しなさい。`, 
            a: "（接線の作図）", 
            e: "中心 $O$ と $P$ の中点を中心とし、点 $P$ を通る円を描き、元の円との交点を結びます。",
            img: "assets/geometry/d1_q9_14.PNG",
            imgA: "assets/geometry/d1_q9_14A.PNG"
        },
        { 
            q: String.raw`$\triangle ABC$ において、辺 $BC$ 上にあり $\triangle ABP = \triangle ACP$ となる点 $P$ を作図しなさい。`, 
            a: "（辺の中点の作図）", 
            e: "底辺が共通の直線上にあり面積が等しいので、辺 $BC$ の中点を求めます。",
            img: "assets/geometry/d1_q9_15.PNG",
            imgA: "assets/geometry/d1_q9_15A.PNG"
        }
    ],

            "d2": [
    { 
        q: String.raw`$n$ 段目のタイルの個数を $n$ で表せ（1, 4, 9...）`, a: String.raw`$n^2$`, e: String.raw`$1^2, 2^2, 3^2 \dots$ と続く2乗の規則性です。`,
        draw: (brd) => { 
            brd.setAttribute({axis:false}); 
            for(let i=0; i<3; i++) for(let j=0; j<3; j++) {
                brd.create('polygon', [[i,-j], [i+1,-j], [i+1,-j-1], [i,-j-1]], {fillColor:'gray', strokeColor:'white', fixed:true});
            }
            brd.create('text', [0.5, 0.5, "n=1"]); brd.create('text', [1.5, 0.5, "n=2..."]);
        }
    },
    { 
        q: String.raw`連続する3つの整数の和が3の倍数になることを証明せよ。`, a: String.raw`$n+(n+1)+(n+2) = 3n+3 = 3(n+1)$`, e: String.raw`$3 \times (\text{整数})$ の形になるため3の倍数といえます。` 
    },
    { 
        q: String.raw`底面の半径 $r$, 高さ $h$ の円柱の体積 $V$ を $h$ について解け。`, a: String.raw`$h = \frac{V}{\pi r^2}$`, e: String.raw`$V = \pi r^2 h$ より。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('ellipse', [[0,1.5], [1.5,1.5], [0,2]], {strokeColor:'black'});
            brd.create('ellipse', [[0,-1.5], [1.5,-1.5], [0,-1]], {strokeColor:'black'});
            brd.create('segment', [[-1.5,1.5], [-1.5,-1.5]], {strokeColor:'black'});
            brd.create('segment', [[1.5,1.5], [1.5,-1.5]], {strokeColor:'black'});
            brd.create('text', [1.7, 0, "h"]); brd.create('segment', [[0,-1.5], [1.5,-1.5]], {dash:2}); brd.create('text', [0.5, -1.8, "r"]);
        }
    },
    { 
        q: String.raw`奇数と奇数の和が偶数になることを証明せよ。`, a: String.raw`$(2m+1)+(2n+1) = 2(m+n+1)$`, e: String.raw`$2 \times (\text{整数})$ は偶数です。` 
    },
    { 
        q: String.raw`2けたの正の整数で、十の位の数と一の位の数を入れかえた数との和。`, a: String.raw`"$11$ の倍数"`, e: String.raw`$(10a+b)+(10b+a) = 11a+11b = 11(a+b)$` 
    },
    { 
        q: String.raw`$n$ 角形の対角線の本数を $n$ を用いて表せ。`, a: String.raw`$\frac{n(n-3)}{2}$`, e: String.raw`1つの頂点から $(n-3)$ 本引けます。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            let p = brd.create('regularpolygon', [[0,1.5], [0,-1.5], 5], {withLabel:false});
            brd.create('segment', [p.vertices[0], p.vertices[2]], {strokeColor:'red', dash:2});
            brd.create('segment', [p.vertices[0], p.vertices[3]], {strokeColor:'red', dash:2});
        }
    },
    { 
        q: String.raw`1辺 $a$ cmの正方形の周の長さ $L$ を $a$ について解け。`, a: String.raw`$a = \frac{L}{4}$`, e: String.raw`$L = 4a$ より。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('polygon', [[-1.5,1.5], [1.5,1.5], [1.5,-1.5], [-1.5,-1.5]]);
            brd.create('text', [0, -1.8, "a"]);
        }
    },
    { 
        q: String.raw`連続する2つの奇数の積に1を足した数は、何の倍数か。`, a: "4 の倍数", e: String.raw`$(2n-1)(2n+1)+1 = 4n^2-1+1 = 4n^2$` 
    },
    { 
        q: String.raw`半径 $r$ の円の周の長さを $l$ とするとき、$r$ について解け。`, a: String.raw`$r = \frac{l}{2\pi}$`, e: String.raw`$l = 2\pi r$ より。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('circle', [[0,0], 2]);
            brd.create('segment', [[0,0], [2,0]], {dash:2});
            brd.create('text', [0.8, 0.2, "r"]);
        }
    }
],

            "d3": [
    { 
        q: String.raw`2点 $A(2, 6), B(4, 10)$ を通る直線の式。`, a: String.raw`$y = 2x + 2$`, e: String.raw`傾き $2$, 切片 $2$。`, 
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [[2,6],[4,10]], {strokeColor:'blue'}); brd.create('point', [2,6], {name:'A'}); brd.create('point', [4,10], {name:'B'}); } 
    },
    { 
        q: String.raw`直線 $y = -x + 8$ と $x$ 軸、 $y$ 軸で囲まれた三角形の面積。`, a: "32", e: String.raw`$8 \times 8 \div 2 = 32$。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('polygon', [[0,0],[8,0],[0,8]], {fillColor:'yellow', fillOpacity:0.3}); brd.create('line', [[8,0],[0,8]], {strokeColor:'blue'}); }
    },
    { 
        q: String.raw`$y = 2x + 3$ に平行で、点 $(1, 2)$ を通る直線の式。`, a: String.raw`$y = 2x$`, e: String.raw`$y - 2 = 2(x - 1)$`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [3,2,-1], {strokeColor:'gray', dash:2}); brd.create('line', [0,2,-1], {strokeColor:'blue'}); brd.create('point', [1,2], {name:'(1,2)'}); }
    },
    { 
        q: String.raw`2直線 $y = x + 2$ と $y = -2x + 8$ の交点の座標。`, a: String.raw`$(2, 4)$`, e: String.raw`連立方程式として解く。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [2,1,-1], {strokeColor:'green'}); brd.create('line', [8,-2,-1], {strokeColor:'red'}); brd.create('point', [2,4], {name:'(2,4)', color:'black'}); }
    },
    { 
        q: String.raw`点 $(3, -1)$ を通り、傾きが $-2$ の直線の式。`, a: String.raw`$y = -2x + 5$`, e: String.raw`$-1 = -2(3) + b \to b = 5$`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [5,-2,-1], {strokeColor:'blue'}); brd.create('point', [3,-1], {name:'(3,-1)'}); }
    },
    { 
        q: String.raw`$x$ 切片が $4$, $y$ 切片が $3$ の直線の式。`, a: String.raw`$y = -\frac{3}{4}x + 3$`, e: String.raw`$(4, 0)$ と $(0, 3)$ を通る。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [[4,0],[0,3]], {strokeColor:'blue'}); brd.create('point', [4,0]); brd.create('point', [0,3]); }
    },
    { 
        q: String.raw`関数 $y = 3x - 5$ で、$x$ の変域が $1 \leqq x \leqq 4$ のときの $y$ の変域。`, a: String.raw`$-2 \leqq y \leqq 7$`, e: String.raw`$x=1$ で $y=-2$, $x=4$ で $y=7$。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('segment', [[1,-2],[4,7]], {strokeColor:'red', strokeWidth:3}); brd.create('line', [-5,3,-1], {dash:1, strokeColor:'gray'}); }
    },
    { 
        q: String.raw`2点 $(-1, 4), (2, -2)$ を通る直線の式。`, a: String.raw`$y = -2x + 2$`, e: String.raw`傾き $(-2-4)/(2-(-1)) = -2$。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [[-1,4],[2,-2]], {strokeColor:'blue'}); brd.create('point', [-1,4]); brd.create('point', [2,-2]); }
    },
    { 
        q: String.raw`直線 $y = \frac{1}{2}x + 1$ 上にあり、$x$ 座標が $4$ である点の $y$ 座標。`, a: "3", e: String.raw`$y = \frac{1}{2}(4) + 1 = 3$`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [1,0.5,-1], {strokeColor:'blue'}); brd.create('point', [4,3], {name:'(4,3)', color:'red'}); }
    },
    { 
        q: String.raw`3点 $(0, 2), (2, 6), (a, 10)$ が一直線上にあるとき、 $a$ の値。`, a: "4", e: String.raw`前の2点から $y = 2x + 2$。これに代入して $10 = 2a + 2$。`,
        draw: (brd) => { brd.create('axis', [[0,0],[1,0]]); brd.create('axis', [[0,0],[0,1]]); brd.create('line', [2,2,-1], {strokeColor:'blue'}); brd.create('point', [0,2]); brd.create('point', [2,6]); brd.create('point', [4,10], {name:'a=4', color:'red'}); }
    }
],

            "d4": [
    { 
        q: String.raw`$\triangle ABC$ で $DE // BC, AD:DB = 1:2$ のとき、$DE:BC$ を求めよ。`, a: String.raw`$1:3$`, e: String.raw`相似比は $AD:AB = 1:(1+2) = 1:3$。`, 
        draw: (brd) => { 
            brd.setAttribute({axis:false}); 
            let a = brd.create('point', [0,4], {name:'A'});
            let b = brd.create('point', [-2,0], {name:'B'});
            let c = brd.create('point', [4,0], {name:'C'});
            brd.create('polygon', [a,b,c]);
            let d = brd.create('point', [-0.66,2.66], {name:'D'});
            let e = brd.create('point', [1.33,2.66], {name:'E'});
            brd.create('segment', [d,e], {strokeColor:'red', strokeWidth:3});
        } 
    },
    { 
        q: String.raw`半径 $5\text{cm}$ の円で、中心からの距離が $3\text{cm}$ である弦の長さ。`, a: "8cm", e: String.raw`三平方の定理より $\sqrt{5^2-3^2} = 4$。弦はその2倍の $8$。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('circle', [[0,0], 5]);
            brd.create('segment', [[-4,3], [4,3]], {strokeColor:'red', strokeWidth:2});
            brd.create('segment', [[0,0], [0,3]], {dash:2});
            brd.create('segment', [[0,0], [4,3]], {dash:2});
            brd.create('text', [0.2, 1.5, "3"]); brd.create('text', [2, 1, "5"]);
        }
    },
    { 
        q: String.raw`1辺 $6\text{cm}$ の正三角形の高さ。`, a: String.raw`$3\sqrt{3}\text{cm}$`, e: String.raw`辺の比 $1:2:\sqrt{3}$ を利用。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('regularpolygon', [[-2,0], [2,0], 3]);
            brd.create('segment', [[0,3.46], [0,0]], {dash:2, strokeColor:'red'});
        }
    },
    { 
        q: String.raw`相似比が $2:3$ の2つの図形の面積比。`, a: String.raw`$4:9$`, e: String.raw`面積比は相似比の2乗になる。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('polygon', [[-4,0], [-2,0], [-2,2], [-4,2]], {fillColor:'blue'});
            brd.create('polygon', [[0,0], [3,0], [3,3], [0,3]], {fillColor:'red'});
        }
    },
    { 
        q: String.raw`円周角の定理より、半円の弧に対する円周角の大きさ。`, a: String.raw`$90^\circ$`, e: String.raw`中心角が $180^\circ$ なのでその半分。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('arc', [[0,0], [3,0], [-3,0]], {strokeColor:'black'});
            brd.create('segment', [[-3,0], [3,0]]);
            brd.create('polyline', [[-3,0], [1,2.82], [3,0]]);
        }
    },
    { 
        q: String.raw`2つの同心円があり、半径が $3\text{cm}$ と $5\text{cm}$ のとき、ドーナツ部分の面積。`, a: String.raw`$16\pi\text{cm}^2$`, e: String.raw`$25\pi - 9\pi = 16\pi$`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('circle', [[0,0], 5], {fillColor:'orange', fillOpacity:0.3});
            brd.create('circle', [[0,0], 3], {fillColor:'white', fillOpacity:1});
        }
    },
    { 
        q: String.raw`$\triangle ABC$ が直角二等辺三角形で、斜辺が $10\text{cm}$ のとき、他の辺の長さ。`, a: String.raw`$5\sqrt{2}\text{cm}$`, e: String.raw`$x : 10 = 1 : \sqrt{2} \to \sqrt{2}x = 10$`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('polygon', [[0,0], [4,0], [0,4]]);
            brd.create('text', [1.5, 2.5, "10"]);
        }
    },
    { 
        q: String.raw`対角線の長さが $8\text{cm}, 10\text{cm}$ のひし形の面積。`, a: String.raw`$40\text{cm}^2$`, e: String.raw`$(8 \times 10) \div 2 = 40$`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('polygon', [[0,2.5], [2,0], [0,-2.5], [-2,0]]);
            brd.create('segment', [[0,2.5], [0,-2.5]], {dash:1});
            brd.create('segment', [[2,0], [-2,0]], {dash:1});
        }
    },
    { 
        q: String.raw`円に内接する四角形 $ABCD$ で、$\angle A = 85^\circ$ のとき $\angle C$ の大きさ。`, a: String.raw`$95^\circ$`, e: String.raw`対角の和は $180^\circ$。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('circle', [[0,0], 3]);
            brd.create('polygon', [[3*Math.cos(1), 3*Math.sin(1)], [3*Math.cos(2.5), 3*Math.sin(2.5)], [3*Math.cos(4), 3*Math.sin(4)], [3*Math.cos(5.8), 3*Math.sin(5.8)]]);
        }
    },
    { 
        q: String.raw`辺の長さが $3, 4, 5$ の三角形はどのような三角形か。`, a: "直角三角形", e: String.raw`$3^2 + 4^2 = 5^2$ が成り立つ（三平方の逆）。`,
        draw: (brd) => {
            brd.setAttribute({axis:false});
            brd.create('polygon', [[0,0], [4,0], [0,3]]);
            brd.create('text', [2, -0.5, "4"]); brd.create('text', [-0.5, 1.5, "3"]); brd.create('text', [2.2, 1.8, "5"]);
        }
    }
],

                "d5": [
        { 
            q: String.raw`底面の半径 $3\text{cm}$，高さ $4\text{cm}$ の円錐の体積を求めなさい。`, 
            a: String.raw`$12\pi\text{cm}^3$`, 
            e: String.raw`円錐の体積 $= \frac{1}{3} \times \pi \times 3^2 \times 4 = 12\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/equbuznt/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`1辺が $6\text{cm}$ の立方体の対角線の長さを求めなさい。`, 
            a: String.raw`$6\sqrt{3}\text{cm}$`, 
            e: String.raw`直方体の対角線の公式 $\sqrt{a^2+b^2+c^2}$ より，$\sqrt{6^2+6^2+6^2} = \sqrt{108} = 6\sqrt{3}$`,
            embed: "https://www.geogebra.org/material/iframe/id/yefdycms/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`半径 $3\text{cm}$ の球の表面積を求めなさい。`, 
            a: String.raw`$36\pi\text{cm}^2$`, 
            e: String.raw`球の表面積 $= 4\pi r^2$ より，$4\pi \times 3^2 = 36\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/ufvgrabv/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`底面が1辺 $4\text{cm}$ の正方形で，高さが $6\text{cm}$ の正四角錐の体積を求めなさい。`, 
            a: String.raw`$32\text{cm}^3$`, 
            e: String.raw`角錐の体積 $= \frac{1}{3} \times (4 \times 4) \times 6 = 32$`,
            embed: "https://www.geogebra.org/material/iframe/id/xd4jjz7e/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`底面の半径が $2\text{cm}$，高さが $5\text{cm}$ の円柱の側面積を求めなさい。`, 
            a: String.raw`$20\pi\text{cm}^2$`, 
            e: String.raw`側面積 $= （底面の周）\times（高さ）= (2\pi \times 2) \times 5 = 20\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/yjz8ye3b/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`正四面体の展開図として正しいものを選びなさい。`, 
            a: "正三角形が4つつながった図", 
            e: String.raw`正四面体は4つの正三角形が図のように結合した形になります。<br><img src='assets/models/d5_6T.png' style='width:100px;'>（正しい図）`,
            img: "assets/models/d5_6T.png"
        },
        { 
            q: String.raw`1辺が $6\text{cm}$ の正四面体の高さを求めなさい。`, 
            a: String.raw`$2\sqrt{6}\text{cm}$`, 
            e: String.raw`高さ $h = \frac{\sqrt{6}}{3}a$ より，$\frac{\sqrt{6}}{3} \times 6 = 2\sqrt{6}$`,
            embed: "https://www.geogebra.org/material/iframe/id/mxqskcwk/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`縦 $3\text{cm}$，横 $4\text{cm}$，高さ $5\text{cm}$ の直方体の対角線の長さを求めなさい。`, 
            a: String.raw`$5\sqrt{2}\text{cm}$`, 
            e: String.raw`$\sqrt{3^2+4^2+5^2} = \sqrt{50} = 5\sqrt{2}$`,
            embed: "https://www.geogebra.org/material/iframe/id/dcg5c2xy/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`半径 $9\text{cm}$，中心角 $120^\circ$ のおうぎ形を側面とする円錐の，底面の半径を求めなさい。`, 
            a: String.raw`$3\text{cm}$`, 
            e: String.raw`底面の円周は側面のおうぎ形の弧の長さに等しいので，$2\pi r = 2\pi \times 9 \times \frac{120}{360}$ より $r=3$`,
            img: "assets/models/d5_9.png"
        },
        { 
            q: String.raw`半径 $5\text{cm}$ の球を，中心から $3\text{cm}$ の距離にある平面で切ったとき，切り口の面積を求めなさい。`, 
            a: String.raw`$16\pi\text{cm}^2$`, 
            e: String.raw`三平方の定理より，切り口の円の半径は $\sqrt{5^2-3^2} = 4$。よって面積は $\pi \times 4^2 = 16\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/xpjmrydd/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        }
    ]
};

const categories = ["d1_q1", "d1_q2", "d1_q3", "d1_q4", "d1_q5", "d1_q6", "d1_q7", "d1_q8", "d1_q9", "d2", "d3", "d4", "d5"];
let currentIdx = 0;
let correctCount = 0;
let testQuestions = [];

function setupTest() {
    testQuestions = categories.map(cat => {
        const pool = MasterDatabase[cat] || [{q:"データ不足", a:"-", e:"-"}];
        return pool[Math.floor(Math.random() * pool.length)];
    });
    displayQuestion();
}

function displayQuestion() {
    const q = testQuestions[currentIdx];
    document.getElementById('current-q-num').innerText = currentIdx + 1;
    document.getElementById('q-text').innerHTML = q.q;
    const img = document.getElementById('test-img');
    const embed = document.getElementById('test-embed');
    img.style.display = 'none'; embed.style.display = 'none';
    if (q.img) { img.src = q.img; img.style.display = 'block'; }
    else if (q.embed) { embed.src = q.embed; embed.style.display = 'block'; }
    if(window.MathJax) MathJax.typesetPromise();
}

function showJudge() {
    const q = testQuestions[currentIdx];
    document.getElementById('test-screen').style.display = 'none';
    document.getElementById('judge-screen').style.display = 'block';
    document.getElementById('correct-ans').innerHTML = q.a;
    document.getElementById('expl-text').innerHTML = q.e;
    if (q.imgA) document.getElementById('test-img').src = q.imgA;
    if(window.MathJax) MathJax.typesetPromise();
}

function nextQuestion(isCorrect) {
    if (isCorrect) correctCount++;
    currentIdx++;
    if (currentIdx < testQuestions.length) {
        document.getElementById('judge-screen').style.display = 'none';
        document.getElementById('test-screen').style.display = 'block';
        displayQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById('judge-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'block';
    document.getElementById('final-score').innerText = correctCount;
    const dev = 35 + (correctCount * 2.7);
    document.getElementById('deviation-value').innerText = dev.toFixed(1);
    let advice = correctCount <= 4 ? "基礎固めを！" : (correctCount <= 9 ? "標準レベルです。" : "素晴らしい！");
    document.getElementById('advice-box').innerHTML = advice;
}

window.onload = setupTest;
</script>
</body>
</html>
