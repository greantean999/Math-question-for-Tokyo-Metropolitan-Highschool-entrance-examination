<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実力判定テスト</title>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* スタイルは先ほどと同じなので中略しますが、メニューボタン用に追加 */
        body { font-family: sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { max-width: 650px; margin: 0 auto; background: white; padding: 25px; border-radius: 15px; }
        .btn { width: 100%; padding: 15px; border-radius: 8px; border: none; cursor: pointer; font-size: 1.1rem; margin-top: 10px; }
        .btn-blue { background: #007bff; color: white; }
        .btn-gray { background: #6c757d; color: white; }
        .media-box { text-align: center; margin: 15px 0; background: #fafafa; min-height: 200px; display: flex; align-items: center; justify-content: center; }
        img { max-width: 100%; height: auto; }
        iframe { width: 100%; height: 350px; border: none; }
        #result-screen, #judge-screen { display: none; }
    </style>
</head>
<body>

<div class="container">
    <div id="test-screen">
        <h2 style="text-align:center;">実力判定テスト</h2>
        <div style="text-align:center; color:#666;">第 <span id="current-q-num">1</span> / 13 問</div>
        <div id="q-text" style="margin:20px 0; font-size:1.1rem;"></div>
        <div class="media-box">
            <img id="test-img" style="display:none;">
            <iframe id="test-embed" style="display:none;"></iframe>
        </div>
        <button class="btn btn-blue" onclick="showJudge()">答え合わせをする</button>
    </div>

    <div id="judge-screen">
        <h3 style="color:#d9534f; text-align:center;">正解：<span id="correct-ans"></span></h3>
        <div id="expl-text" style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:20px;"></div>
        <button class="btn" style="background:#28a745; color:white;" onclick="nextQuestion(true)">正解！</button>
        <button class="btn btn-gray" onclick="nextQuestion(false)">不正解...</button>
    </div>

    <div id="result-screen" style="text-align:center;">
        <h2>テスト結果</h2>
        <div style="font-size:3rem; color:#d9534f; font-weight:bold;"><span id="final-score">0</span> / 13</div>
        <div style="background:#e9ecef; padding:15px; border-radius:10px; margin:20px 0; font-size:1.3rem;">
            推定偏差値: <span id="deviation-value">--</span>
        </div>
        <div id="advice-box" style="text-align:left; border-left:5px solid #007bff; padding-left:15px;"></div>
        <button class="btn btn-blue" onclick="location.reload()">もう一度挑戦</button>
        <button class="btn btn-gray" onclick="location.href='index.html'">メニューに戻る</button>
    </div>
</div>

<script>
// --- ここに MasterDatabase を貼り付け ---
const MasterDatabase = {
        "d1_q1": [
        { q: "$1 - 6 \\times (-2)$", a: "$13$", e: "$1 - (-12) = 13$" },
        { q: "$(-4)^2 \\div 8 - 5$", a: "$-3$", e: "$16 \\div 8 - 5 = 2 - 5 = -3$" },
        { q: "$8a + b - (a - 7b)$", a: "$7a + 8b$", e: "$8a + b - a + 7b = 7a + 8b$" },
        { q: "$(-2)^3 \\times 3 - 4 \\div (-2)$", a: "$-22$", e: "$-24 + 2 = -22$" },
        { q: "$\\frac{3x - y}{2} - \\frac{x - 4y}{4}$", a: "$\\frac{5x + 2y}{4}$", e: "$\\frac{6x-2y-x+4y}{4}$" },
        { q: "$18ab^2 \\div 6b \\times (-2a)$", a: "$-6a^2b$", e: "$3ab \\times (-2a) = -6a^2b$" },
        { q: "$5 + 2 \\times (3 - 8)$", a: "$-5$", e: "$5 - 10 = -5$" },
        { q: "$6x^2 \\div (-3x)^2 \\times 3x$", a: "$2x$", e: "$6x^2 \\div 9x^2 \\times 3x = 2x$" },
        { q: "$9 - (-3)^2 \\div 3$", a: "$6$", e: "$9 - 3 = 6$" },
        { q: "$7 + (-4) - (-9)$", a: "$12$", e: "$7 - 4 + 9 = 12$" },
        { q: "$4(a-b) - 3(2a-b)$", a: "$-2a-b$", e: "$4a-4b-6a+3b$" },
        { q: "$(-3)^2 + 5 \\times (-2)$", a: "$-1$", e: "$9 - 10 = -1$" },
        { q: "$12ab \\div (-4a) \\times 3b$", a: "$-9b^2$", e: "$-3b \\times 3b = -9b^2$" },
        { q: "$2(3x+y) + (x-2y)$", a: "$7x$", e: "$6x+2y+x-2y$" },
        { q: "$(-1)^4 \\times 7 - 8$", a: "$-1$", e: "$1 \\times 7 - 8 = -1$" },
        { q: "$\\frac{1}{3}(6x-9) - 2x$", a: "$-3$", e: "$2x-3-2x = -3$" },
        { q: "$15x^2y \\div 5xy \\times (-2y)$", a: "$-6y^2$", e: "$3x \\times (-2y)$" },
        { q: "$7 - 2^3 \\div 4$", a: "$5$", e: "$7 - 2 = 5$" },
        { q: "$a+2b - \\frac{a-b}{3}$", a: "$\\frac{2a+7b}{3}$", e: "$\\frac{3a+6b-a+b}{3}$" },
        { q: "$(-6)^2 \\div 4 + (-3)$", a: "$6$", e: "$9 - 3 = 6$" }
    ],
    "d1_q2": [
        { q: String.raw`$(\sqrt{3} + 1)^2$`, a: String.raw`$4 + 2\sqrt{3}$`, e: String.raw`$3 + 2\sqrt{3} + 1$` },
        { q: String.raw`$(\sqrt{5} + 2)(\sqrt{5} - 2)$`, a: String.raw`$1$`, e: String.raw`$5 - 4 = 1$` },
        { q: String.raw`$\sqrt{50} - \sqrt{18}$`, a: String.raw`$2\sqrt{2}$`, e: String.raw`$5\sqrt{2} - 3\sqrt{2} = 2\sqrt{2}$` },
        { q: String.raw`$\frac{12}{\sqrt{6}} - \sqrt{24}$`, a: String.raw`$0$`, e: String.raw`$2\sqrt{6} - 2\sqrt{6} = 0$` },
        { q: String.raw`$\sqrt{3} + \frac{6}{\sqrt{3}}$`, a: String.raw`$3\sqrt{3}$`, e: String.raw`$\sqrt{3} + 2\sqrt{3} = 3\sqrt{3}$` },
        { q: String.raw`$(\sqrt{7}-1)(\sqrt{7}+3)$`, a: String.raw`$4+2\sqrt{7}$`, e: String.raw`$7+3\sqrt{7}-\sqrt{7}-3 = 4+2\sqrt{7}$` },
        { q: String.raw`$\sqrt{32} \div \sqrt{2} - \sqrt{9}$`, a: String.raw`$1$`, e: String.raw`$\sqrt{16} - 3 = 4-3=1$` },
        { q: String.raw`$\sqrt{2}(\sqrt{8} + \sqrt{18})$`, a: String.raw`$10$`, e: String.raw`$\sqrt{2}(2\sqrt{2}+3\sqrt{2}) = \sqrt{2} \times 5\sqrt{2} = 10$` },
        { q: String.raw`$(\sqrt{6}+\sqrt{2})(\sqrt{6}-\sqrt{2})$`, a: String.raw`$4$`, e: String.raw`$6-2=4$` },
        { q: String.raw`$\frac{\sqrt{75}}{\sqrt{3}} - \sqrt{4}$`, a: String.raw`$3$`, e: String.raw`$\sqrt{25}-2 = 5-2=3$` },
        { q: String.raw`$(\sqrt{3}-2)^2 + \sqrt{12}$`, a: String.raw`$7-2\sqrt{3}$`, e: String.raw`$3-4\sqrt{3}+4+2\sqrt{3} = 7-2\sqrt{3}$` },
        { q: String.raw`$\sqrt{48} - \frac{9}{\sqrt{3}}$`, a: String.raw`$\sqrt{3}$`, e: String.raw`$4\sqrt{3}-3\sqrt{3} = \sqrt{3}$` },
        { q: String.raw`$(\sqrt{5}+1)^2 - \sqrt{20}$`, a: String.raw`$6$`, e: String.raw`$5+2\sqrt{5}+1-2\sqrt{5} = 6$` },
        { q: String.raw`$\sqrt{27} + \sqrt{12} - \sqrt{75}$`, a: String.raw`$0$`, e: String.raw`$3\sqrt{3}+2\sqrt{3}-5\sqrt{3} = 0$` },
        { q: String.raw`$\frac{10}{\sqrt{5}} + \sqrt{5}$`, a: String.raw`$3\sqrt{5}$`, e: String.raw`$2\sqrt{5}+\sqrt{5} = 3\sqrt{5}$` }
    ],
    "d1_q3": [
        { q: String.raw`$9x - 4 = 5(x + 4)$`, a: String.raw`$x = 6$`, e: String.raw`$9x-4=5x+20 \to 4x=24$` },
        { q: String.raw`$\frac{x-1}{2} - \frac{x+2}{3} = 1$`, a: String.raw`$x = 13$`, e: String.raw`$3(x-1)-2(x+2)=6 \to 3x-3-2x-4=6 \to x=13$` },
        { q: String.raw`$0.3x - 0.1 = 0.5x + 0.7$`, a: String.raw`$x = -4$`, e: String.raw`$3x-1=5x+7 \to -2x=8$` },
        { q: String.raw`$4x - 7 = x + 8$`, a: String.raw`$x = 5$`, e: String.raw`$3x=15 \to x=5$` },
        { q: String.raw`$3(x-2) = 2x + 5$`, a: String.raw`$x = 11$`, e: String.raw`$3x-6=2x+5$` },
        { q: String.raw`$\frac{2}{3}x - 1 = \frac{1}{2}x$`, a: String.raw`$x = 6$`, e: String.raw`$4x-6=3x \to x=6$` },
        { q: String.raw`$5x + 2 = 3(x-4)$`, a: String.raw`$x = -7$`, e: String.raw`$5x+2=3x-12 \to 2x=-14$` },
        { q: String.raw`$x - 8 = 4x + 10$`, a: String.raw`$x = -6$`, e: String.raw`$-3x=18$` },
        { q: String.raw`$0.2x + 1.5 = 0.5x$`, a: String.raw`$x = 5$`, e: String.raw`$2x+15=5x \to 3x=15$` },
        { q: String.raw`$7x - (2x-5) = 15$`, a: String.raw`$x = 2$`, e: String.raw`$5x+5=15 \to 5x=10$` },
        { q: String.raw`$\frac{x+3}{4} = 2$`, a: String.raw`$x = 5$`, e: String.raw`$x+3=8$` },
        { q: String.raw`$8 - x = 3x$`, a: String.raw`$x = 2$`, e: String.raw`$8=4x$` },
        { q: String.raw`$2(x+1) = x-5$`, a: String.raw`$x = -7$`, e: String.raw`$2x+2=x-5$` },
        { q: String.raw`$0.04x = 0.12$`, a: String.raw`$x = 3$`, e: String.raw`$4x=12$` },
        { q: String.raw`$12x - 3 = 7x + 12$`, a: String.raw`$x = 3$`, e: String.raw`$5x=15$` }
    ],
    "d1_q4": [
        { q: String.raw`$\begin{cases} x + 2y = 7 \\ 2x - y = 4 \end{cases}$`, a: String.raw`$x = 3, y = 2$`, e: String.raw`下の式を2倍して足すと $5x=15$` },
        { q: String.raw`$\begin{cases} y = 2x - 1 \\ 3x + 2y = 12 \end{cases}$`, a: String.raw`$x = 2, y = 3$`, e: String.raw`上の式を下の $y$ に代入すると $3x + 2(2x-1) = 12$` },
        { q: String.raw`$\begin{cases} 3x + 2y = 13 \\ x - 2y = 7 \end{cases}$`, a: String.raw`$x = 5, y = -1$`, e: String.raw`そのまま足すと $4x = 20$` },
        { q: String.raw`$\begin{cases} 2x + 3y = 8 \\ 2x + y = 4 \end{cases}$`, a: String.raw`$x = 1, y = 2$`, e: String.raw`上の式から下の式を引くと $2y = 4$` },
        { q: String.raw`$\begin{cases} x = 3y \\ 2x - 5y = 1 \end{cases}$`, a: String.raw`$x = 3, y = 1$`, e: String.raw`代入して $6y - 5y = 1$` },
        { q: String.raw`$\begin{cases} x + y = 5 \\ x - y = 1 \end{cases}$`, a: String.raw`$x = 3, y = 2$`, e: String.raw`足すと $2x = 6$, 引くと $2y = 4$` },
        { q: String.raw`$\begin{cases} 2x + y = 7 \\ x + y = 4 \end{cases}$`, a: String.raw`$x = 3, y = 1$`, e: String.raw`引くと $x = 3$` },
        { q: String.raw`$\begin{cases} 3x - 2y = 8 \\ 2x + y = 3 \end{cases}$`, a: String.raw`$x = 2, y = -1$`, e: String.raw`下の式を2倍して足すと $7x = 14$` },
        { q: String.raw`$\begin{cases} x + 3y = 10 \\ 2x + y = 5 \end{cases}$`, a: String.raw`$x = 1, y = 3$`, e: String.raw`上の式を2倍して引くと $5y = 15$` },
        { q: String.raw`$\begin{cases} y = 3x \\ x + y = 4 \end{cases}$`, a: String.raw`$x = 1, y = 3$`, e: String.raw`代入して $x + 3x = 4$` },
        { q: String.raw`$\begin{cases} 4x + 3y = 1 \\ 3x + 2y = 0 \end{cases}$`, a: String.raw`$x = -2, y = 3$`, e: String.raw`係数を12に揃えて解く。` },
        { q: String.raw`$\begin{cases} x - 2y = -4 \\ y = 2x - 1 \end{cases}$`, a: String.raw`$x = 2, y = 3$`, e: String.raw`代入して $x - 2(2x-1) = -4$` },
        { q: String.raw`$\begin{cases} 5x + 2y = 16 \\ 3x - y = 3 \end{cases}$`, a: String.raw`$x = 2, y = 3$`, e: String.raw`下の式を2倍して足すと $11x = 22$` },
        { q: String.raw`$\begin{cases} x + y = 2 \\ 2x + 3y = 5 \end{cases}$`, a: String.raw`$x = 1, y = 1$`, e: String.raw`上の式を2倍して引くと $y = 1$` },
        { q: String.raw`$\begin{cases} 2x - 3y = 1 \\ x + 2y = 4 \end{cases}$`, a: String.raw`$x = 2, y = 1$`, e: String.raw`下の式を2倍して引くと $-7y = -7$` }
    ],
    "d1_q5": [
        { q: String.raw`$x^2 + 5x + 6 = 0$`, a: String.raw`$x = -2, -3$`, e: String.raw`$(x+2)(x+3)=0$` },
        { q: String.raw`$x^2 - 7x + 10 = 0$`, a: String.raw`$x = 2, 5$`, e: String.raw`$(x-2)(x-5)=0$` },
        { q: String.raw`$x^2 + 2x - 15 = 0$`, a: String.raw`$x = 3, -5$`, e: String.raw`$(x-3)(x+5)=0$` },
        { q: String.raw`$x^2 - 6x + 9 = 0$`, a: String.raw`$x = 3$`, e: String.raw`$(x-3)^2=0$ (重解)` },
        { q: String.raw`$x^2 + 3x + 1 = 0$`, a: String.raw`$x = \frac{-3 \pm \sqrt{5}}{2}$`, e: String.raw`因数分解できないので解の公式を利用。` },
        { q: String.raw`$x^2 - 5 = 0$`, a: String.raw`$x = \pm \sqrt{5}$`, e: String.raw`$x^2 = 5$ より。` },
        { q: String.raw`$3x^2 = 12$`, a: String.raw`$x = \pm 2$`, e: String.raw`$x^2 = 4$ より。` },
        { q: String.raw`$(x-2)^2 = 9$`, a: String.raw`$x = 5, -1$`, e: String.raw`$x-2 = \pm 3$ より。` },
        { q: String.raw`$x^2 - x - 12 = 0$`, a: String.raw`$x = 4, -3$`, e: String.raw`$(x-4)(x+3)=0$` },
        { q: String.raw`$2x^2 + 5x + 2 = 0$`, a: String.raw`$x = -2, -\frac{1}{2}$`, e: String.raw`解の公式を利用。` },
        { q: String.raw`$x^2 = 7x$`, a: String.raw`$x = 0, 7$`, e: String.raw`$x^2 - 7x = 0 \to x(x-7)=0$` },
        { q: String.raw`$x^2 + 10x + 25 = 0$`, a: String.raw`$x = -5$`, e: String.raw`$(x+5)^2=0$` },
        { q: String.raw`$x^2 - 4x + 1 = 0$`, a: String.raw`$x = 2 \pm \sqrt{3}$`, e: String.raw`解の公式 $x = \frac{-b' \pm \sqrt{b'^2 - ac}}{a}$ を利用。` },
        { q: String.raw`$x^2 - 2x - 8 = 0$`, a: String.raw`$x = 4, -2$`, e: String.raw`$(x-4)(x+2)=0$` },
        { q: String.raw`$x^2 + 4x = 0$`, a: String.raw`$x = 0, -4$`, e: String.raw`$x(x+4)=0$` }
    ],
    "d1_q6": [
        { q: String.raw`関数 $y = 2x^2$ で、$x$ の値が $1$ から $3$ まで増加するときの変化の割合を求めなさい。`, a: String.raw`$8$`, e: String.raw`変化の割合 $= a(x_1 + x_2) = 2(1 + 3) = 8$`, img: "assets/graphs/d1_q6_1.png" },
        { q: String.raw`関数 $y = -x^2$ で、$x$ の値が $-4$ から $-2$ まで増加するときの変化の割合を求めなさい。`, a: String.raw`$6$`, e: String.raw`変化の割合 $= -1(-4 + (-2)) = -1(-6) = 6$`, img: "assets/graphs/d1_q6_2.png" },
        { q: String.raw`関数 $y = 3x^2$ で、$x$ の変域が $-1 \leqq x \leqq 2$ のときの $y$ の変域を求めなさい。`, a: String.raw`$0 \leqq y \leqq 12$`, e: String.raw`$x=0$ で最小値 $0$、$x=2$ で最大値 $3(2)^2=12$ となります。`, img: "assets/graphs/d1_q6_3.png" },
        { q: String.raw`関数 $y = ax^2$ において、$x$ の値が $2$ から $4$ まで増加するときの変化の割合が $12$ であるとき、$a$ の値を求めなさい。`, a: String.raw`$a = 2$`, e: String.raw`$a(2 + 4) = 12$ より $6a = 12 \to a = 2$`, img: "assets/graphs/d1_q6_4.png" },
        { q: String.raw`関数 $y = \frac{1}{2}x^2$ で、$x$ の変域が $-4 \leqq x \leqq 2$ のときの $y$ の変域を求めなさい。`, a: String.raw`$0 \leqq y \leqq 8$`, e: String.raw`$x=0$ で最小値 $0$、$x=-4$ で最大値 $\frac{1}{2}(-4)^2=8$ となります。`, img: "assets/graphs/d1_q6_5.png" },
        { q: String.raw`関数 $y = -2x^2$ について、$x$ の値が $1$ から $4$ まで増加するときの変化の割合を求めなさい。`, a: String.raw`$-10$`, e: String.raw`変化の割合 $= -2(1 + 4) = -10$`, img: "assets/graphs/d1_q6_6.png" },
        { q: String.raw`関数 $y = ax^2$ で、$x$ の変域が $-2 \leqq x \leqq 1$ のとき、$y$ の変域が $0 \leqq y \leqq 8$ となります。$a$ の値を求めなさい。`, a: String.raw`$a = 2$`, e: String.raw`$y$ の最大値が正なので $a>0$。$x=-2$ のとき $y=8$ となるので $a(-2)^2=8 \to 4a=8 \to a=2$`, img: "assets/graphs/d1_q6_7.png" },
        { q: String.raw`関数 $y = \frac{1}{4}x^2$ で、$x$ の値が $2$ から $6$ まで増加するときの変化の割合を求めなさい。`, a: String.raw`$2$`, e: String.raw`変化の割合 $= \frac{1}{4}(2 + 6) = \frac{1}{4} \times 8 = 2$`, img: "assets/graphs/d1_q6_8.png" },
        { q: String.raw`関数 $y = -3x^2$ で、$x$ の変域が $-1 \leqq x \leqq 3$ のときの $y$ の変域を求めなさい。`, a: String.raw`$-27 \leqq y \leqq 0$`, e: String.raw`$x=3$ のとき最小値 $-3(3)^2 = -27$、$x=0$ で最大値 $0$ となります。`, img: "assets/graphs/d1_q6_9.png" },
        { q: String.raw`変化の割合が常に $3$ で、点 $(1, 5)$ を通る直線の式を求めなさい。`, a: String.raw`$y = 3x + 2$`, e: String.raw`$y = 3x + b$ に $(1, 5)$ を代入。 $5 = 3(1) + b \to b = 2$`, img: "assets/graphs/d1_q6_10.png" },
        { q: String.raw`関数 $y = x^2$ と $y = 2x + 3$ のグラフの交点の $x$ 座標をすべて求めなさい。`, a: String.raw`$x = 3, -1$`, e: String.raw`$x^2 = 2x + 3 \to x^2 - 2x - 3 = 0 \to (x-3)(x+1) = 0$`, img: "assets/graphs/d1_q6_11.png" },
        { q: String.raw`関数 $y = \frac{4}{x}$ で、$x$ の値が $1$ から $4$ まで増加するときの変化の割合を求めなさい。`, a: String.raw`$-1$`, e: String.raw`$x=1$ のとき $y=4$、$x=4$ のとき $y=1$。 変化の割合 $= \frac{1 - 4}{4 - 1} = \frac{-3}{3} = -1$`, img: "assets/graphs/d1_q6_12.png" },
        { q: String.raw`関数 $y = -2x^2$ で、$y$ の変域が $-18 \leqq y \leqq 0$ となるような $x$ の変域を求めなさい。`, a: String.raw`$-3 \leqq x \leqq 3$`, e: String.raw`$-2x^2 = -18$ より $x^2 = 9 \to x = \pm 3$。よって変域は $-3 \leqq x \leqq 3$`, img: "assets/graphs/d1_q6_13.png" },
        { q: String.raw`関数 $y = ax^2$ と $y = -3x - 1$ について、$x$ の値が $1$ から $3$ まで変化するときの変化の割合が一致するとき、$a$ の値を求めなさい。`, a: String.raw`$a = -0.75$`, e: String.raw`$a(1 + 3) = -3 \to 4a = -3 \to a = -3/4$`, img: "assets/graphs/d1_q6_14.png" },
        { q: String.raw`関数 $y = \frac{1}{3}x^2$ について、$x$ の変域が $-3 \leqq x \leqq 6$ のときの $y$ の変域を求めなさい。`, a: String.raw`$0 \leqq y \leqq 12$`, e: String.raw`$x=0$ で最小値 $0$、$x=6$ で最大値 $\frac{1}{3}(6)^2 = 12$ となります。`, img: "assets/graphs/d1_q6_15.png" }
    ],
    "d1_q7": [
        { q: String.raw`正九角形の $1$ つの内角の大きさを求めなさい。`, a: String.raw`$140^\circ$`, e: String.raw`外角の和は $360^\circ$ なので、一つの外角は $360 \div 9 = 40^\circ$。内角は $180 - 40 = 140^\circ$。`, img: "assets/geometry/d1_q7_1.PNG" },
        { q: String.raw`半径 $6\text{cm}$, 中心角 $120^\circ$ のおうぎ形の弧の長さを求めなさい。`, a: String.raw`$4\pi \text{cm}$`, e: String.raw`$2\pi \times 6 \times \frac{120}{360} = 4\pi$`, img: "assets/geometry/d1_q7_2.PNG" },
        { q: String.raw`円周角の定理において、中心角が $80^\circ$ のとき、同じ弧に対する円周角の大きさを求めなさい。`, a: String.raw`$40^\circ$`, e: String.raw`円周角は中心角の半分になります。$80 \div 2 = 40$`, img: "assets/geometry/d1_q7_3.PNG" },
        { q: String.raw`$n$ 角形の内角の和が $1260^\circ$ であるとき、$n$ の値を求めなさい。`, a: String.raw`$9$`, e: String.raw`内角の和の公式 $180(n-2) = 1260$ より、$n-2 = 7$。よって $n=9$。` },
        { q: String.raw`対角線の本数が $20$ 本である多角形は何角形か答えなさい。`, a: "八角形", e: String.raw`対角線の公式 $\frac{n(n-3)}{2} = 20$ より、$n^2-3n-40=0 \to (n-8)(n+5)=0$。よって $n=8$。` },
        { q: String.raw`三角形の $2$ つの内角が $45^\circ, 65^\circ$ のとき、残りの $1$ つの角の外角の大きさを求めなさい。`, a: String.raw`$110^\circ$`, e: String.raw`三角形の外角の性質より、$45 + 65 = 110$。`, img: "assets/geometry/d1_q7_6.PNG" },
        { q: String.raw`円に内接する四角形で、向かい合う角の和は何度になるか答えなさい。`, a: String.raw`$180^\circ$`, e: String.raw`円に内接する四角形の性質です。` },
        { q: String.raw`中心角 $72^\circ$ のおうぎ形は、円全体の何分の $1$ か求めなさい。`, a: String.raw`$\frac{1}{5}$`, e: String.raw`$\frac{72}{360} = \frac{1}{5}$`, img: "assets/geometry/d1_q7_8.PNG" },
        { q: String.raw`正六角形の $1$ つの外角の大きさを求めなさい。`, a: String.raw`$60^\circ$`, e: String.raw`$360 \div 6 = 60$`, img: "assets/geometry/d1_q7_9.PNG" },
        { q: String.raw`直角二等辺三角形の鋭角の大きさを求めなさい。`, a: String.raw`$45^\circ$`, e: String.raw`$(180 - 90) \div 2 = 45$`, img: "assets/geometry/d1_q7_10.PNG" },
        { q: String.raw`半径 $10\text{cm}$、弧の長さ $4\pi\text{cm}$ のおうぎ形の面積を求めなさい。`, a: String.raw`$20\pi \text{cm}^2$`, e: String.raw`面積 $S = \frac{1}{2}lr = \frac{1}{2} \times 4\pi \times 10 = 20\pi$`, img: "assets/geometry/d1_q7_11.PNG" },
        { q: String.raw`対角線の長さが $8\text{cm}$ と $6\text{cm}$ であるひし形の面積を求めなさい。`, a: String.raw`$24 \text{cm}^2$`, e: String.raw`$(8 \times 6) \div 2 = 24$`, img: "assets/geometry/d1_q7_12.PNG" },
        { q: String.raw`平行四辺形 $ABCD$ で $\angle A=110^\circ$ のとき、$\angle B$ の大きさを求めなさい。`, a: String.raw`$70^\circ$`, e: String.raw`平行四辺形の隣り合う角の和は $180^\circ$ です。$180 - 110 = 70$`, img: "assets/geometry/d1_q7_13.PNG" },
        { q: String.raw`円周上に $3$ 点 $A,B,C$ があり、線分 $AC$ が円の直径であるとき、$\angle ABC$ の大きさを求めなさい。`, a: String.raw`$90^\circ$`, e: String.raw`半円の弧に対する円周角は常に $90^\circ$ です。`, img: "assets/geometry/d1_q7_14.PNG" }
    ],

    "d1_q8": [
        { q: String.raw`$2$ 枚の硬貨を同時に投げるとき、少なくとも $1$ 枚が表になる確率を求めなさい。`, a: String.raw`$\frac{3}{4}$`, e: String.raw`全体は4通り。両方裏の1通りを除いて $\frac{3}{4}$` },
        { q: String.raw`$1$ つのサイコロを $2$ 回振り、出た目の積が奇数になる確率を求めなさい。`, a: String.raw`$\frac{1}{4}$`, e: String.raw`「奇数 $\times$ 奇数」のときのみ積は奇数になる。$\frac{1}{2} \times \frac{1}{2} = \frac{1}{4}$` },
        { q: String.raw`$1$ つのサイコロを $2$ 回振り、出た目の和が $10$ 以上になる確率を求めなさい。`, a: String.raw`$\frac{1}{6}$`, e: String.raw`$(4,6), (5,5), (5,6), (6,4), (6,5), (6,6)$ の6通り。$\frac{6}{36} = \frac{1}{6}$` },
        { q: String.raw`赤玉 $3$ 個、白玉 $2$ 個が入った袋から同時に $2$ 個取り出すとき、それらが同じ色である確率を求めなさい。`, a: String.raw`$\frac{2}{5}$`, e: String.raw`全体は10通り。赤2個は3通り、白2個は1通り。計4通り。$\frac{4}{10} = \frac{2}{5}$` },
        { q: String.raw`$1, 2, 3, 4$ の数字が書かれた $4$ 枚のカードから同時に $2$ 枚引くとき、和が素数になる確率を求めなさい。`, a: String.raw`$\frac{2}{3}$`, e: String.raw`組合せは(1,2),(1,3),(1,4),(2,3),(2,4),(3,4)の6通り。和は3,4,5,5,6,7。素数は3,5,5,7の4通り。$\frac{4}{6} = \frac{2}{3}$` },
        { q: String.raw`$2$ つのサイコロを同時に投げ、出た目の差の絶対値が $4$ 以上になる確率を求めなさい。`, a: String.raw`$\frac{1}{6}$`, e: String.raw`差が4：(1,5),(2,6),(5,1),(6,2)。差が5：(1,6),(6,1)。計6通り。$\frac{6}{36} = \frac{1}{6}$` },
        { q: String.raw`$3$ 枚の硬貨を同時に投げるとき、すべて同じ向き（すべて表、またはすべて裏）になる確率を求めなさい。`, a: String.raw`$\frac{1}{4}$`, e: String.raw`全体は8通り。表表表、裏裏裏の2通り。$\frac{2}{8} = \frac{1}{4}$` },
        { q: String.raw`$1$ から $6$ までの数字が書かれたサイコロを投げ、出た目を $a$ とするとき、$\frac{12}{a}$ が整数になる確率を求めなさい。`, a: String.raw`$\frac{2}{3}$`, e: String.raw`$a$ は12の約数であればよい。$1, 2, 3, 4, 6$ の5通り。あ、サイコロなので $5/6$ です。失礼、修正：$a \in \{1,2,3,4,6\}$ なので $\frac{5}{6}$` },
        { q: String.raw`男子 $3$ 人、女子 $2$ 人の中から、くじ引きで $2$ 人の委員を選ぶとき、男子 $1$ 人、女子 $1$ 人が選ばれる確率を求めなさい。`, a: String.raw`$\frac{3}{5}$`, e: String.raw`全体は10通り。男子3人から1人(3通り) $\times$ 女子2人から1人(2通り) = 6通り。$\frac{6}{10} = \frac{3}{5}$` },
        { q: String.raw`$5$ 本中 $2$ 本の当たりが入っているくじを、$A$ さんが引いた後、戻さずに $B$ さんが引くとき、二人とも当たる確率を求めなさい。`, a: String.raw`$\frac{1}{10}$`, e: String.raw`$\frac{2}{5} \times \frac{1}{4} = \frac{2}{20} = \frac{1}{10}$` },
        { q: String.raw`$1$ つのサイコロを $2$ 回振り、出た目の和が $7$ になる確率を求めなさい。`, a: String.raw`$\frac{1}{6}$`, e: String.raw`$(1,6), (2,5), (3,4), (4,3), (5,2), (6,1)$ の6通り。$\frac{6}{36} = \frac{1}{6}$` },
        { q: String.raw`袋の中に青玉 $4$ 個、黄玉 $6$ 個が入っている。ここから $1$ 個取り出すとき、それが青玉である確率を求めなさい。`, a: String.raw`$\frac{2}{5}$`, e: String.raw`$\frac{4}{4+6} = \frac{4}{10} = \frac{2}{5}$` },
        { q: String.raw`$A, B, C, D$ の $4$ 人が横一列に並ぶとき、$A$ と $B$ が隣り合う確率を求めなさい。`, a: String.raw`$\frac{1}{2}$`, e: String.raw`全体は24通り。ABを1組と数えると $3! \times 2 = 12$ 通り。$\frac{12}{24} = \frac{1}{2}$` },
        { q: String.raw`大小 $2$ つのサイコロを投げ、大きいサイコロの目を $a$, 小さいサイコロの目を $b$ とするとき、$a > b$ となる確率を求めなさい。`, a: String.raw`$\frac{5}{12}$`, e: String.raw`全体36通り。$a=b$ は6通り。それ以外(30通り)の半分が $a>b$。$\frac{15}{36} = \frac{5}{12}$` },
        { q: String.raw`$3$ 本のくじの中に $1$ 本の当たりがある。$A, B, C$ の $3$ 人がこの順に引くとき、$C$ さんが当たる確率を求めなさい。`, a: String.raw`$\frac{1}{3}$`, e: String.raw`順番に関わらず、当たる確率は等しく $\frac{1}{3}$。` }
    ],
    "d1_q9": [
        { q: String.raw`線分 $AB$ の垂直二等分線を作図しなさい。`, a: "（垂直二等分線の作図）", e: "2点A, Bから等しい半径の弧を描き、その2つの交点を通る直線を引きます。", img: "assets/geometry/d1_q9_1.PNG", imgA: "assets/geometry/d1_q9_1A.PNG" },
        { q: String.raw`$\angle ABC$ の二等分線を作図しなさい。`, a: "（角の二等分線の作図）", e: "頂点Bを中心とする弧を描き、辺との交点からさらに等しい半径の弧を描いて交点を作ります。", img: "assets/geometry/d1_q9_2.PNG", imgA: "assets/geometry/d1_q9_2A.PNG" },
        { q: String.raw`点 $P$ を通り直線 $l$ に垂直な直線を作図しなさい。`, a: "（垂線の作図）", e: "点Pを中心とする弧を描き、直線 $l$ との交点からさらに弧を描いて交点を作ります。", img: "assets/geometry/d1_q9_3.PNG", imgA: "assets/geometry/d1_q9_3A.PNG" },
        { q: String.raw`円の周上の点 $A$ を通る、この円の接線を作図しなさい。`, a: "（接線の作図）", e: "中心 $O$ と点 $A$ を結ぶ半直線を引き、点 $A$ を通る垂線を引きます。", img: "assets/geometry/d1_q9_4.PNG", imgA: "assets/geometry/d1_q9_4A.PNG" },
        { q: String.raw`$3$ 点 $A, B, C$ から等しい距離にある点 $P$ を作図しなさい。`, a: "（外心の作図）", e: "2つの線分（例：ABとBC）の垂直二等分線を引き、その交点を $P$ とします。", img: "assets/geometry/d1_q9_5.PNG", imgA: "assets/geometry/d1_q9_5A.PNG" },
        { q: String.raw`辺 $BC$ を底辺としたときの、$\triangle ABC$ の高さを示す線分を作図しなさい。`, a: "（高さの作図）", e: "点 $A$ から辺 $BC$（またはその延長線）へ下ろした垂線が高さとなります。", img: "assets/geometry/d1_q9_6.PNG", imgA: "assets/geometry/d1_q9_6A.PNG" },
        { q: String.raw`長方形 $ABCD$ を、対角線 $AC$ を軸に折り返したときの頂点 $B$ の移動先 $B'$ を作図しなさい。`, a: "（線対称の作図）", e: "点 $B$ から対角線 $AC$ へ垂線を引き、同じ距離だけ反対側へ伸ばした点が $B'$ です。", img: "assets/geometry/d1_q9_7.PNG", imgA: "assets/geometry/d1_q9_7A.PNG" },
        { q: String.raw`円の中心 $O$ を作図によって求めなさい。`, a: "（円の中心の作図）", e: "円周上の任意の2つの弦について、それぞれの垂直二等分線を引き、その交点を $O$ とします。", img: "assets/geometry/d1_q9_8.PNG", imgA: "assets/geometry/d1_q9_8A.PNG" },
        { q: String.raw`点 $P$ を通り直線 $l$ に平行な直線を作図しなさい。`, a: "（平行線の作図）", e: "点 $P$ を通る垂線を引いた後、その垂線に対して点 $P$ を通る垂線をもう一度引きます。", img: "assets/geometry/d1_q9_9.PNG", imgA: "assets/geometry/d1_q9_9A.PNG" },
        { q: String.raw`$60^\circ$ の角度を作図しなさい。`, a: "（正三角形の利用）", e: "1つの線分を1辺とする正三角形を描くと、その内角はすべて $60^\circ$ になります。", img: "assets/geometry/d1_q9_10.PNG", imgA: "assets/geometry/d1_q9_10A.PNG" },
        { q: String.raw`$30^\circ$ の角度を作図しなさい。`, a: "（60度の二等分）", e: "まず $60^\circ$ を作図し、その角の二等分線を引くことで $30^\circ$ を作ります。", img: "assets/geometry/d1_q9_11.PNG", imgA: "assets/geometry/d1_q9_11A.PNG" },
        { q: String.raw`線分 $AB$ を $1:3$ に分ける点を作図しなさい。`, a: "（垂直二等分線の繰り返し）", e: "線分 $AB$ の垂直二等分線で2等分し、さらに $A$ 側の線分を二等分することで $1:3$ の点を作ります。", img: "assets/geometry/d1_q9_12.PNG", imgA: "assets/geometry/d1_q9_12A.PNG" },
        { q: String.raw`辺 $AB$ 上にあり、辺 $AC, BC$ から等しい距離にある点を作図しなさい。`, a: "（角の二等分線と辺の交点）", e: "$\angle C$ の二等分線を引き、辺 $AB$ との交点を求めます。", img: "assets/geometry/d1_q9_13.PNG", imgA: "assets/geometry/d1_q9_13A.PNG" },
        { q: String.raw`円の外の点 $P$ から、この円への接線を作図しなさい。`, a: "（接線の作図）", e: "中心 $O$ と $P$ の中点を中心とし、点 $P$ を通る円を描き、元の円との交点を結びます。", img: "assets/geometry/d1_q9_14.PNG", imgA: "assets/geometry/d1_q9_14A.PNG" },
        { q: String.raw`$\triangle ABC$ において、辺 $BC$ 上にあり $\triangle ABP = \triangle ACP$ となる点 $P$ を作図しなさい。`, a: "（辺の中点の作図）", e: "底辺が共通の直線上にあり面積が等しいので、辺 $BC$ の中点を求めます。", img: "assets/geometry/d1_q9_15.PNG", imgA: "assets/geometry/d1_q9_15A.PNG" }
    ],
    "d2": [
        { q: String.raw`連続する3つの整数の和は 3 の倍数になることを証明した。最小の整数を $n$ とするとき、その和を $n$ を用いて表しなさい。`, a: String.raw`$3n + 3$`, e: String.raw`$n + (n+1) + (n+2) = 3n + 3 = 3(n+1)$` },
        { q: String.raw`$2$ 桁の正の整数で、十の位の数を $a$、一の位の数を $b$ とするとき、この整数を式で表しなさい。`, a: String.raw`$10a + b$`, e: String.raw`例えば 35 は $10 \times 3 + 5$ と表せる。` },
        { q: String.raw`底面の半径 $r$, 高さ $h$ の円柱の体積を $V$ とするとき、これを $h$ について解きなさい。`, a: String.raw`$h = \frac{V}{\pi r^2}$`, e: String.raw`$V = \pi r^2 h$ の両辺を $\pi r^2$ で割る。` },
        { q: String.raw`等式 $3x + 2y = 10$ を $y$ について解きなさい。`, a: String.raw`$y = \frac{10 - 3x}{2}$`, e: String.raw`$2y = 10 - 3x$ より。` },
        { q: String.raw`$1$ 辺 $x\text{cm}$ の正方形の周の長さを $y\text{cm}$ とするとき、$y$ を $x$ の式で表しなさい。`, a: String.raw`$y = 4x$`, e: String.raw`$x$ が4つ分なので $4x$。` },
        { q: String.raw`縦 $a\text{cm}$、横 $b\text{cm}$ の長方形の面積が $S$ であるとき、これを $b$ について解きなさい。`, a: String.raw`$b = \frac{S}{a}$`, e: String.raw`$S = ab$ より。` },
        { q: String.raw`奇数を整数 $n$ を使って表しなさい。`, a: String.raw`$2n + 1$ (または $2n - 1$)`, e: String.raw`偶数 $2n$ に $1$ を足すと奇数になる。` },
        { q: String.raw`定価 $x$ 円の品物を $2$ 割引で買ったときの代金を式で表しなさい。`, a: String.raw`$0.8x$ 円`, e: String.raw`$1 - 0.2 = 0.8$` },
        { q: String.raw`等式 $l = 2\pi r$ を $r$ について解きなさい。`, a: String.raw`$r = \frac{l}{2\pi}$`, e: String.raw`円周の公式の変形。` },
        { q: String.raw`$1$ 本 $x$ 円の鉛筆 $5$ 本と、$1$ 個 $y$ 円の消しゴム $1$ 個を買ったときの合計金額を式で表しなさい。`, a: String.raw`$5x + y$`, e: String.raw`単価 $\times$ 個数の合計。` },
        { q: String.raw`$x$ km の道のりを時速 $4$ km で歩いたときにかかった時間を式で表しなさい。`, a: String.raw`$\frac{x}{4}$ 時間`, e: String.raw`時間 = 道のり $\div$ 速さ。` },
        { q: String.raw`$a$ 個のりんごを $b$ 人に $3$ 個ずつ配ると $2$ 個余る。この関係を等式で表しなさい。`, a: String.raw`$a = 3b + 2$`, e: String.raw`全体 = 配った数 + 余り。` },
        { q: String.raw`台形の面積を $S$、上底を $a$、下底を $b$、高さを $h$ とするとき、$S = \frac{1}{2}(a+b)h$ を $a$ について解きなさい。`, a: String.raw`$a = \frac{2S}{h} - b$`, e: String.raw`$2S = (a+b)h \to \frac{2S}{h} = a+b$` },
        { q: String.raw`ある数 $x$ から $5$ を引いて $3$ 倍すると $12$ になる。この関係を方程式で表しなさい。`, a: String.raw`$3(x - 5) = 12$`, e: String.raw`言葉の通りに式を組み立てる。` },
        { q: String.raw`三角形の内角の和が $180^\circ$ であることを利用して、$n$ 角形の内角の和を式で表しなさい。`, a: String.raw`$180(n - 2)$`, e: String.raw`$1$ つの頂点から引ける対角線によって $(n-2)$ 個の三角形に分けられるため。` }
    ],
    "d3": [
        { q: String.raw`傾きが $3$ で、点 $(0, 5)$ を通る直線の式を求めなさい。`, a: String.raw`$y = 3x + 5$`, e: String.raw`切片が $5$ なので、$y = ax + b$ に代入する。` },
        { q: String.raw`$2$ 点 $(1, 2), (3, 6)$ を通る直線の式を求めなさい。`, a: String.raw`$y = 2x$`, e: String.raw`傾きは $\frac{6-2}{3-1} = 2$。$y = 2x + b$ に点を通すと $b=0$。` },
        { q: String.raw`一次関数 $y = -2x + 4$ において、$x$ の値が $3$ 増加したときの $y$ の増加量を求めなさい。`, a: String.raw`$-6$`, e: String.raw`変化の割合（$-2$） $\times$ $x$の増加量（$3$） $= -6$` },
        { q: String.raw`直線 $y = \frac{1}{2}x - 3$ と $x$ 軸との交点の座標を求めなさい。`, a: String.raw`$(6, 0)$`, e: String.raw`$y = 0$ を代入すると $0 = \frac{1}{2}x - 3$ より $x = 6$` },
        { q: String.raw`直線 $y = 4x - 1$ に平行で、点 $(1, 7)$ を通る直線の式を求めなさい。`, a: String.raw`$y = 4x + 3$`, e: String.raw`平行なので傾きは $4$。$7 = 4(1) + b$ より $b = 3$` },
        { q: String.raw`一次関数 $y = ax + 3$ のグラフが点 $(2, -1)$ を通るとき、$a$ の値を求めなさい。`, a: String.raw`$a = -2$`, e: String.raw`$-1 = 2a + 3$ より $2a = -4$` },
        { q: String.raw`$2$ 点 $(2, 3), (4, 3)$ を通る直線の式を求めなさい。`, a: String.raw`$y = 3$`, e: String.raw`$y$ の値が常に $3$ なので、$x$ 軸に平行な直線になる。` },
        { q: String.raw`一次関数 $f(x) = -3x + 2$ において、$f(-1)$ の値を求めなさい。`, a: String.raw`$5$`, e: String.raw`$-3(-1) + 2 = 3 + 2 = 5$` },
        { q: String.raw`直線 $y = x + 5$ と $y = -x + 1$ の交点の座標を求めなさい。`, a: String.raw`$(-2, 3)$`, e: String.raw`連立方程式 $x + 5 = -x + 1$ を解くと $2x = -4$` },
        { q: String.raw`傾きが $-\frac{2}{3}$ で、切片が $-1$ の直線の式を求めなさい。`, a: String.raw`$y = -\frac{2}{3}x - 1$`, e: String.raw`傾きと切片をそのまま公式に当てはめる。` },
        { q: String.raw`一次関数 $y = -x + 6$ で、$x$ の変域が $1 \le x \le 4$ のときの $y$ の変域を求めなさい。`, a: String.raw`$2 \le y \le 5$`, e: String.raw`$x=1$ のとき $y=5$、$x=4$ のとき $y=2$。` },
        { q: String.raw`直線の式 $2x - y + 4 = 0$ を、$y = \dots$ の形に変形しなさい。`, a: String.raw`$y = 2x + 4$`, e: String.raw`$-y = -2x - 4$ の両辺に $-1$ をかける。` },
        { q: String.raw`一次関数 $y = 5x - 2$ のグラフが $y$ 軸と交わる点の座標を求めなさい。`, a: String.raw`$(0, -2)$`, e: String.raw`$x = 0$ のときの $y$ の値が切片。` },
        { q: String.raw`$y$ が $x$ の一次関数であり、変化の割合が $4$ で、$x=1$ のとき $y=2$ である。この式の切片を求めなさい。`, a: String.raw`$-2$`, e: String.raw`$2 = 4(1) + b$ より $b = -2$` },
        { q: String.raw`グラフが原点を通り、点 $(3, -6)$ を通る直線の式を求めなさい。`, a: String.raw`$y = -2x$`, e: String.raw`原点を通るので比例の式 $y = ax$ に代入する。` }
    ],
    "d4": [
        { q: String.raw`$\triangle ABC$ と $\triangle DEF$ が相似で、相似比が $2:3$ である。$\triangle ABC$ の面積が $20\text{cm}^2$ のとき、$\triangle DEF$ の面積を求めなさい。`, a: String.raw`$45\text{cm}^2$`, e: String.raw`面積比は相似比の2乗なので $2^2:3^2 = 4:9$。$20 \times \frac{9}{4} = 45$` },
        { q: String.raw`平行線 $l, m, n$ があり、直線 $p$ との交点を上から $A, B, C$、直線 $q$ との交点を $D, E, F$ とする。$AB=3, BC=6, DE=4$ のとき、$EF$ の長さを求めなさい。`, a: String.raw`$8$`, e: String.raw`平行線と線分の比より、$3:6 = 4:EF$。$1:2 = 4:EF$ なので $EF=8$` },
        { q: String.raw`半径 $5\text{cm}$ の円で、中心からの距離が $3\text{cm}$ である弦の長さを求めなさい。`, a: String.raw`$8\text{cm}$`, e: String.raw`三平方の定理より弦の半分は $\sqrt{5^2 - 3^2} = 4$。よって $4 \times 2 = 8$` },
        { q: String.raw`相似な2つの円錐 $A, B$ があり、相似比が $3:4$ である。円錐 $A$ の体積が $54\pi\text{cm}^3$ のとき、円錐 $B$ の体積を求めなさい。`, a: String.raw`$128\pi\text{cm}^3$`, e: String.raw`体積比は相似比の3乗なので $3^3:4^3 = 27:64$。$54\pi \times \frac{64}{27} = 128\pi$` },
        { q: String.raw`円周角の定理において、同じ弧に対する円周角の大きさが $35^\circ$ であるとき、その弧に対する中心角の大きさを求めなさい。`, a: String.raw`$70^\circ$`, e: String.raw`中心角は円周角の2倍になる。` },
        { q: String.raw`直角三角形において、斜辺が $13\text{cm}$、他の $1$ 辺が $5\text{cm}$ であるとき、残りの $1$ 辺の長さを求めなさい。`, a: String.raw`$12\text{cm}$`, e: String.raw`$\sqrt{13^2 - 5^2} = \sqrt{169 - 25} = \sqrt{144} = 12$` },
        { q: String.raw`$\triangle ABC$ で辺 $AB, AC$ の中点をそれぞれ $M, N$ とする。$BC=10\text{cm}$ のとき、線分 $MN$ の長さを求めなさい。`, a: String.raw`$5\text{cm}$`, e: String.raw`中点連結定理より、$MN$ は $BC$ の半分の長さになる。` },
        { q: String.raw`$1$ 辺の長さが $6\text{cm}$ の正三角形の面積を求めなさい。`, a: String.raw`$9\sqrt{3}\text{cm}^2$`, e: String.raw`高さは $3\sqrt{3}$。面積は $\frac{1}{2} \times 6 \times 3\sqrt{3} = 9\sqrt{3}$` },
        { q: String.raw`円に内接する四角形 $ABCD$ において、$\angle A = 80^\circ$ のとき、向かい合う $\angle C$ の大きさを求めなさい。`, a: String.raw`$100^\circ$`, e: String.raw`円に内接する四角形の対角の和は $180^\circ$ である。` },
        { q: String.raw`ある線分の比が $AD:DB = 2:3$ であるとき、全体の線分 $AB$ に対する $AD$ の比（$AD:AB$）を求めなさい。`, a: String.raw`$2:5$`, e: String.raw`全体は $2+3=5$ 分の比率になる。` },
        { q: String.raw`$2$ 点 $A(1, 2), B(4, 6)$ 間の距離を求めなさい。`, a: String.raw`$5$`, e: String.raw`$\sqrt{(4-1)^2 + (6-2)^2} = \sqrt{3^2 + 4^2} = \sqrt{25} = 5$` },
        { q: String.raw`相似比が $1:k$ である $2$ つの図形について、面積比を $k$ を用いて表しなさい。`, a: String.raw`$1:k^2$`, e: String.raw`面積比は相似比の2乗に比例する。` },
        { q: String.raw`半径 $6\text{cm}$ の円において、中心角 $120^\circ$ のおうぎ形の弧の長さを求めなさい。`, a: String.raw`$4\pi\text{cm}$`, e: String.raw`$2\pi \times 6 \times \frac{120}{360} = 4\pi$` },
        { q: String.raw`中心角が等しいとき、おうぎ形の面積は半径の何乗に比例するか答えなさい。`, a: String.raw`$2$ 乗`, e: String.raw`面積公式 $S = \pi r^2 \times \frac{\text{中心角}}{360}$ より。` },
        { q: String.raw`$\triangle ABC$ において、$\angle A=90^\circ, AB=AC=4$ の直角二等辺三角形の斜辺 $BC$ の長さを求めなさい。`, a: String.raw`$4\sqrt{2}$`, e: String.raw`辺の比 $1:1:\sqrt{2}$ を利用する。` }
    ],
    "d5": [
        { 
            q: String.raw`底面の半径 $3\text{cm}$，高さ $4\text{cm}$ の円錐の体積を求めなさい。`, 
            a: String.raw`$12\pi\text{cm}^3$`, 
            e: String.raw`$\frac{1}{3} \times \pi \times 3^2 \times 4 = 12\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/equbuznt/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false" 
        },
        { 
            q: String.raw`半径 $3\text{cm}$ の球の表面積を求めなさい。`, 
            a: String.raw`$36\pi\text{cm}^2$`, 
            e: String.raw`$4\pi \times 3^2 = 36\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/ufvgrabv/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`半径 $3\text{cm}$ の球の体積を求めなさい。`, 
            a: String.raw`$36\pi\text{cm}^3$`, 
            e: String.raw`$\frac{4}{3}\pi \times 3^3 = 36\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/ufvgrabv/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`底面の半径 $2\text{cm}$，母線の長さ $5\text{cm}$ の円錐の側面積を求めなさい。`, 
            a: String.raw`$10\pi\text{cm}^2$`, 
            e: String.raw`公式（側面積 = $\pi \times \text{母線} \times \text{半径}$）より $\pi \times 5 \times 2 = 10\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/equbuznt/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        },
        { 
            q: String.raw`底面の半径 $4\text{cm}$，高さ $10\text{cm}$ の円柱の体積を求めなさい。`, 
            a: String.raw`$160\pi\text{cm}^3$`, 
            e: String.raw`$\pi \times 4^2 \times 10 = 160\pi$`,
            embed: "https://www.geogebra.org/material/iframe/id/m6nveuzd/width/400/height/300/ai/false/smb/false/stb/false/stbh/false/asb/false/sri/false/rc/false"
        }
    ],

};

const categories = ["d1_q1", "d1_q2", "d1_q3", "d1_q4", "d1_q5", "d1_q6", "d1_q7", "d1_q8", "d1_q9", "d2", "d3", "d4", "d5"];
let currentIdx = 0;
let correctCount = 0;
let testQuestions = [];

function setupTest() {
    testQuestions = categories.map(cat => {
        const pool = MasterDatabase[cat] || [{q:"データ不足", a:"-", e:"-"}];
        return pool[Math.floor(Math.random() * pool.length)];
    });
    displayQuestion();
}
    
    window.onload = setupTest;
    
// 問題を表示するコアロジック
function displayProblem(problem) {
    // 1. テキスト（数式）の表示
    const qText = document.getElementById('question-text') || document.getElementById('q-text');
    qText.innerHTML = problem.q;

    // 2. メディア表示のリセット
    const imgTag = document.getElementById('q-image') || document.getElementById('test-img');
    const embedTag = document.getElementById('q-embed') || document.getElementById('test-embed');
    const jxgBox = document.getElementById('jxgbox'); // 動的グラフ用（あれば）

    if (imgTag) imgTag.style.display = 'none';
    if (embedTag) {
        embedTag.style.display = 'none';
        embedTag.src = ""; // 前の動画を止める
    }
    if (jxgBox) jxgBox.style.display = 'none';

    // 3. データの種類に応じて表示を切り替え
    if (problem.img) {
        imgTag.src = problem.img;
        imgTag.style.display = 'block';
    } else if (problem.embed) {
        embedTag.src = problem.embed;
        embedTag.style.display = 'block';
    } else if (problem.draw && typeof problem.draw === 'function') {
        // drawが「命令文」として表示されないよう、ここで実行する
        if (jxgBox) {
            jxgBox.style.display = 'block';
            const board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-5, 5, 5, -5], axis: true});
            problem.draw(board);
        }
    }

    // 4. 数式を綺麗にレンダリング
    if (window.MathJax) {
        MathJax.typesetPromise();
    }
}


function showJudge() {
    const q = testQuestions[currentIdx];
    document.getElementById('test-screen').style.display = 'none';
    document.getElementById('judge-screen').style.display = 'block';
    document.getElementById('correct-ans').innerHTML = q.a;
    document.getElementById('expl-text').innerHTML = q.e;
    if (q.imgA) document.getElementById('test-img').src = q.imgA;
    if(window.MathJax) MathJax.typesetPromise();
}

function nextQuestion(isCorrect) {
    if (isCorrect) correctCount++;
    currentIdx++;
    if (currentIdx < testQuestions.length) {
        document.getElementById('judge-screen').style.display = 'none';
        document.getElementById('test-screen').style.display = 'block';
        displayQuestion();
    } else {
        showResult();
    }
}

function showResult() {
    document.getElementById('judge-screen').style.display = 'none';
    document.getElementById('result-screen').style.display = 'block';
    document.getElementById('final-score').innerText = correctCount;
    const dev = 35 + (correctCount * 2.7);
    document.getElementById('deviation-value').innerText = dev.toFixed(1);
    let advice = correctCount <= 4 ? "基礎固めを！" : (correctCount <= 9 ? "標準レベルです。" : "素晴らしい！");
    document.getElementById('advice-box').innerHTML = advice;
}

</script>
</body>
</html>
