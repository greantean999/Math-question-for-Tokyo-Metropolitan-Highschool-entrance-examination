<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問1完全版</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$']] }, chtml: { matchFontHeight: false } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fdfdfd; }
        .nav-header { margin-bottom: 10px; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #007AFF; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-btn { padding: 10px; cursor: pointer; border-radius: 8px; border: 1px solid #ddd; background: #fff; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .nav-btn.active { background: #007AFF; color: white; border-color: #007AFF; }
        #prob-text { font-size: 1.25em; line-height: 1.8; margin: 20px 0; min-height: 80px; }
        .jxgbox { width: 100%; height: 300px; margin: 15px 0; display: none; border-radius: 10px; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #34C759; color: white; cursor: pointer; font-weight: bold; }
        .ans-box { display: none; margin-top: 20px; padding: 15px; background: #fef4f4; border-radius: 10px; border: 2px solid #ffcccc; }
    </style>
</head>
<body>

<div class="nav-header">
    <a href="index.html" class="back-link">← メニューに戻る</a>
</div>

<div class="card">
    <div class="nav-grid">
        <button class="nav-btn" onclick="select(1, this)">(1)四則</button>
        <button class="nav-btn" onclick="select(2, this)">(2)文字式</button>
        <button class="nav-btn" onclick="select(3, this)">(3)平方根</button>
        <button class="nav-btn" onclick="select(4, this)">(4)1次方程式</button>
        <button class="nav-btn" onclick="select(5, this)">(5)連立方程式</button>
        <button class="nav-btn" onclick="select(6, this)">(6)2次方程式</button>
        <button class="nav-btn" onclick="select(7, this)">(7)確率</button>
        <button class="nav-btn" onclick="select(8, this)">(8)角度・変域</button>
        <button class="nav-btn" onclick="select(9, this)">(9)作図</button>
    </div>

    <div id="prob-text">学習したい項目を選んでください。</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()" style="display:none;">答え合わせ</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.4em; color:#d00; border-bottom:1px solid #ffcccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.8; margin-top: 10px; background: white; padding: 10px; border-radius: 5px;"></div>
        <button class="action-btn" style="background:#8E8E93; margin-top:15px;" onclick="loadProblem()">次の問題</button>
    </div>
</div>

<script>
let board = null;
let currentCat = 0;
let lastIdx = -1;

const database = {
    1: [ // 四則・計算
        { text: String.raw`$1 + 6 \times (-2)$`, ans: String.raw`$-11$`, exp: String.raw`$1 - 12 = -11$` },
        { text: String.raw`$(-4)^2 + 9 \div (-3)$`, ans: String.raw`$13$`, exp: String.raw`$16 - 3 = 13$` },
        { text: String.raw`$5 - (-2)^3 \times 2$`, ans: String.raw`$21$`, exp: String.raw`$5 - (-8) \times 2 = 5 + 16 = 21$` },
        { text: String.raw`$(-7) \times 4 + 15$`, ans: String.raw`$-13$`, exp: String.raw`$-28 + 15 = -13$` },
        { text: String.raw`$3 \times (-2)^2 - 10$`, ans: String.raw`$2$`, exp: String.raw`$3 \times 4 - 10 = 12 - 10 = 2$` },
        { text: String.raw`$(-6)^2 \div 4 - 8$`, ans: String.raw`$1$`, exp: String.raw`$36 \div 4 - 8 = 9 - 8 = 1$` },
        { text: String.raw`$7 - 3 \times (-4)$`, ans: String.raw`$19$`, exp: String.raw`$7 + 12 = 19$` },
        { text: String.raw`$(-9) + 4 \times (-2)$`, ans: String.raw`$-17$`, exp: String.raw`$-9 - 8 = -17$` },
        { text: String.raw`$(-2)^2 - (-5) \times 3$`, ans: String.raw`$19$`, exp: String.raw`$4 + 15 = 19$` },
        { text: String.raw`$6 \div (-2) + (-3)^2$`, ans: String.raw`$6$`, exp: String.raw`$-3 + 9 = 6$` }
    ],
    2: [ // 文字式
        { text: String.raw`$4(x-y) - (3x-2y)$`, ans: String.raw`$x-2y$`, exp: String.raw`$4x-4y-3x+2y = x-2y$` },
        { text: String.raw`$5a + 3b - 2(a - 2b)$`, ans: String.raw`$3a + 7b$`, exp: String.raw`$5a + 3b - 2a + 4b = 3a + 7b$` },
        { text: String.raw`$\frac{1}{2}(4x-6y) + 3y$`, ans: String.raw`$2x$`, exp: String.raw`$2x - 3y + 3y = 2x$` },
        { text: String.raw`$7a - b - 4(a - 2b)$`, ans: String.raw`$3a + 7b$`, exp: String.raw`$7a - b - 4a + 8b = 3a + 7b$` },
        { text: String.raw`$12x^2y \div 4xy \times 2x$`, ans: String.raw`$6x^2$`, exp: String.raw`$3x \times 2x = 6x^2$` },
        { text: String.raw`$3(2a-b) - 5(a-b)$`, ans: String.raw`$a+2b$`, exp: String.raw`$6a-3b-5a+5b = a+2b$` },
        { text: String.raw`$(15x-10y) \div 5 + 2y$`, ans: String.raw`$3x$`, exp: String.raw`$3x-2y+2y = 3x$` },
        { text: String.raw`$4(x+y) - 3(x-y)$`, ans: String.raw`$x+7y$`, exp: String.raw`$4x+4y-3x+3y = x+7y$` },
        { text: String.raw`$\frac{2a-b}{3} \times 9 - 5a$`, ans: String.raw`$a-3b$`, exp: String.raw`$3(2a-b) - 5a = 6a-3b-5a = a-3b$` },
        { text: String.raw`$x^2 - 3x - (x^2 - 5x)$`, ans: String.raw`$2x$`, exp: String.raw`$x^2-3x-x^2+5x = 2x$` }
    ],
    3: [ // 平方根
        { text: String.raw`$\sqrt{27} - \sqrt{12}$`, ans: String.raw`$\sqrt{3}$`, exp: String.raw`$3\sqrt{3} - 2\sqrt{3} = \sqrt{3}$` },
        { text: String.raw`$\sqrt{50} + \sqrt{18}$`, ans: String.raw`$8\sqrt{2}$`, exp: String.raw`$5\sqrt{2} + 3\sqrt{2} = 8\sqrt{2}$` },
        { text: String.raw`$\frac{10}{\sqrt{5}} - \sqrt{5}$`, ans: String.raw`$\sqrt{5}$`, exp: String.raw`$2\sqrt{5} - \sqrt{5} = \sqrt{5}$` },
        { text: String.raw`$(\sqrt{3}+2)(\sqrt{3}-2)$`, ans: String.raw`$-1$`, exp: String.raw`$3 - 4 = -1$` },
        { text: String.raw`$\sqrt{2}(\sqrt{8} + \sqrt{18})$`, ans: String.raw`$10$`, exp: String.raw`$\sqrt{16} + \sqrt{36} = 4 + 6 = 10$` },
        { text: String.raw`$(\sqrt{7}+1)^2 - \sqrt{28}$`, ans: String.raw`$8$`, exp: String.raw`$7 + 2\sqrt{7} + 1 - 2\sqrt{7} = 8$` },
        { text: String.raw`$\frac{\sqrt{48}}{\sqrt{3}} - \sqrt{9}$`, ans: String.raw`$1$`, exp: String.raw`$\sqrt{16} - 3 = 4 - 3 = 1$` },
        { text: String.raw`$\sqrt{2} \times \sqrt{6} + \sqrt{3}$`, ans: String.raw`$3\sqrt{3}$`, exp: String.raw`$\sqrt{12} + \sqrt{3} = 2\sqrt{3} + \sqrt{3} = 3\sqrt{3}$` },
        { text: String.raw`$(\sqrt{6}+\sqrt{2})(\sqrt{6}-\sqrt{2})$`, ans: String.raw`$4$`, exp: String.raw`$6 - 2 = 4$` },
        { text: String.raw`$\sqrt{20} - \frac{5}{\sqrt{5}}$`, ans: String.raw`$\sqrt{5}$`, exp: String.raw`$2\sqrt{5} - \sqrt{5} = \sqrt{5}$` }
    ],
    4: [ // 1次方程式
        { text: String.raw`$4x - 7 = x + 5$`, ans: String.raw`$x = 4$`, exp: String.raw`$3x = 12 \Rightarrow x = 4$` },
        { text: String.raw`$3(x - 2) = x + 4$`, ans: String.raw`$x = 5$`, exp: String.raw`$3x - 6 = x + 4 \Rightarrow 2x = 10$` },
        { text: String.raw`$0.5x + 1.2 = 0.2x + 3$`, ans: String.raw`$x = 6$`, exp: String.raw`$3x = 18 \Rightarrow x = 6$` },
        { text: String.raw`$\frac{x-1}{2} = 3$`, ans: String.raw`$x = 7$`, exp: String.raw`$x - 1 = 6 \Rightarrow x = 7$` },
        { text: String.raw`$2x + 9 = 5x$`, ans: String.raw`$x = 3$`, exp: String.raw`$3x = 9 \Rightarrow x = 3$` },
        { text: String.raw`$4 - 2(x - 1) = 10$`, ans: String.raw`$x = -2$`, exp: String.raw`$4 - 2x + 2 = 10 \Rightarrow -2x = 4$` },
        { text: String.raw`$\frac{1}{3}x = \frac{1}{4}x + 1$`, ans: String.raw`$x = 12$`, exp: String.raw`両辺12倍して $4x = 3x + 12$` },
        { text: String.raw`$7x + 2 = 4x - 1$`, ans: String.raw`$x = -1$`, exp: String.raw`$3x = -3 \Rightarrow x = -1$` },
        { text: String.raw`$5(x - 1) = 2(x + 5)$`, ans: String.raw`$x = 5$`, exp: String.raw`$5x - 5 = 2x + 10 \Rightarrow 3x = 15$` },
        { text: String.raw`$x - 8 = -3x$`, ans: String.raw`$x = 2$`, exp: String.raw`$4x = 8 \Rightarrow x = 2$` }
    ],
    5: [ // 連立方程式
        { text: String.raw`$\begin{cases} x+y=7 \\ x-y=1 \end{cases}$`, ans: String.raw`$x=4, y=3$`, exp: String.raw`足して $2x=8 \Rightarrow x=4$` },
        { text: String.raw`$\begin{cases} 2x+y=10 \\ x+y=7 \end{cases}$`, ans: String.raw`$x=3, y=4$`, exp: String.raw`引いて $x=3$` },
        { text: String.raw`$\begin{cases} y=x+2 \\ 2x+y=11 \end{cases}$`, ans: String.raw`$x=3, y=5$`, exp: String.raw`代入法で $2x + (x+2) = 11 \Rightarrow 3x=9$` },
        { text: String.raw`$\begin{cases} 3x+2y=12 \\ x=y+4 \end{cases}$`, ans: String.raw`$x=4, y=0$`, exp: String.raw`代入法で $3(y+4)+2y=12 \Rightarrow 5y=0$` },
        { text: String.raw`$\begin{cases} 4x-3y=1 \\ 2x+y=3 \end{cases}$`, ans: String.raw`$x=1, y=1$`, exp: String.raw`下を3倍して足すと $10x=10$` }
        // ※連立は計算が複雑なので、まずは厳選5問！
    ],
    6: [ // 2次方程式
        { text: String.raw`$x^2 - 6x + 8 = 0$`, ans: String.raw`$x=2, 4$`, exp: String.raw`$(x-2)(x-4)=0$` },
        { text: String.raw`$x^2 + 5x + 6 = 0$`, ans: String.raw`$x=-2, -3$`, exp: String.raw`$(x+2)(x+3)=0$` },
        { text: String.raw`$x^2 - 9 = 0$`, ans: String.raw`$x=\pm 3$`, exp: String.raw`$x^2 = 9$` },
        { text: String.raw`$x^2 - 5x = 0$`, ans: String.raw`$x=0, 5$`, exp: String.raw`$x(x-5)=0$` },
        { text: String.raw`$x^2 + 2x - 1 = 0$`, ans: String.raw`$x=-1 \pm \sqrt{2}$`, exp: String.raw`解の公式 $x = \frac{-2 \pm \sqrt{4 - 4(1)(-1)}}{2}$` },
        { text: String.raw`$x^2 - 3x + 1 = 0$`, ans: String.raw`$x = \frac{3 \pm \sqrt{5}}{2}$`, exp: String.raw`解の公式を使用` },
        { text: String.raw`$(x-3)^2 = 5$`, ans: String.raw`$x=3 \pm \sqrt{5}$`, exp: String.raw`$x-3 = \pm\sqrt{5}$` },
        { text: String.raw`$2x^2 - 4x - 6 = 0$`, ans: String.raw`$x=-1, 3$`, exp: String.raw`$x^2-2x-3=0 \Rightarrow (x+1)(x-3)=0$` },
        { text: String.raw`$x^2 + 10x + 25 = 0$`, ans: String.raw`$x=-5$`, exp: String.raw`$(x+5)^2 = 0$` },
        { text: String.raw`$x^2 = 7x$`, ans: String.raw`$x=0, 7$`, exp: String.raw`$x^2 - 7x = 0$` }
    ],
    7: [ // 確率
        { text: "1から6までの目が出るサイコロを1回投げるとき、3の倍数が出る確率。", ans: String.raw`$\frac{1}{3}$`, exp: String.raw`3, 6の2通り。$2/6 = 1/3$` },
        { text: "1から6までのサイコロを2回投げるとき、出た目の和が5になる確率。", ans: String.raw`$\frac{1}{9}$`, exp: String.raw`(1,4),(2,3),(3,2),(4,1)の4通り。$4/36 = 1/9$` },
        { text: "1から6までのサイコロを2回投げるとき、2つの目が同じになる確率。", ans: String.raw`$\frac{1}{6}$`, exp: String.raw`(1,1)から(6,6)までの6通り。$6/36 = 1/6$` },
        { text: "硬貨を2枚同時に投げるとき、1枚が表で1枚が裏になる確率。", ans: String.raw`$\frac{1}{2}$`, exp: String.raw`(表,裏),(裏,表)の2通り。全体は4通りなので $2/4 = 1/2$` },
        { text: "袋の中に赤玉3個、白玉2個がある。同時に2個取り出すとき、2個とも赤玉である確率。", ans: String.raw`$\frac{3}{10}$`, exp: String.raw`全体の組み合わせは10通り、赤2個は3通り。` },
        { text: "1から6までのサイコロを2回投げるとき、積が12になる確率。", ans: String.raw`$\frac{1}{9}$`, exp: String.raw`(2,6),(3,4),(4,3),(6,2)の4通り。$4/36 = 1/9$` },
        { text: "A,B,Cの3人からくじ引きで委員を2人選ぶとき、Aが選ばれる確率。", ans: String.raw`$\frac{2}{3}$`, exp: String.raw`(A,B),(A,C),(B,C)のうちAを含むのは2通り。` },
        { text: "1から6までのサイコロを2回投げるとき、少なくとも一方は1の目が出る確率。", ans: String.raw`$\frac{11}{36}$`, exp: String.raw`全体36から「両方1以外(25通り)」を引くと11通り。` },
        { text: "男の子2人、女の子2人の4人から2人の当番を選ぶとき、男女1人ずつになる確率。", ans: String.raw`$\frac{2}{3}$`, exp: String.raw`全6通り中、男女ペアは4通り。$4/6 = 2/3$` },
        { text: "1から6までのサイコロを2回投げるとき、出た目の和が10以上になる確率。", ans: String.raw`$\frac{1}{6}$`, exp: String.raw`(4,6),(5,5),(5,6),(6,4),(6,5),(6,6)の6通り。$6/36 = 1/6$` }
    ],
    8: [ // 角度・変域
        { 
            text: String.raw`$l // m$ のとき、$\angle x$ の大きさを求めなさい。`, 
            ans: String.raw`$50^{\circ}$`, 
            exp: String.raw`平行線の錯角は等しいので、$\angle x = 50^{\circ}$ です。`,
            draw: (brd) => {
                brd.create('line', [[-3,1],[3,1]], {name:'l', withLabel:true, fixed:true});
                brd.create('line', [[-3,-1],[3,-1]], {name:'m', withLabel:true, fixed:true});
                brd.create('line', [[-1,-1],[1,1]], {color:'orange'});
                brd.create('text', [0.2, 0.7, "50°"]); brd.create('text', [-0.5, -0.7, "x"]);
            }
        },
        { text: String.raw`$y = 2x^2$ で $x$ の変域が $1 \le x \le 3$ のときの $y$ の変域。`, ans: String.raw`$2 \le y \le 18$`, exp: String.raw`$x=1 \Rightarrow y=2, x=3 \Rightarrow y=18$ です。` },
        { text: String.raw`$y = -x^2$ で $x$ の変域が $-2 \le x \le 1$ のときの $y$ の変域。`, ans: String.raw`$-4 \le y \le 0$`, exp: String.raw`$x=0$ で最大値 $0$ 、 $x=-2$ で最小値 $-4$ です。` },
        { text: "半径 6cm、中心角 $60^{\circ}$ のおうぎ形の弧の長さ。", ans: String.raw`$2\pi \text{ cm}$`, exp: String.raw`$12\pi \times \frac{60}{360} = 2\pi$` },
        { text: String.raw`正十角形の1つの内角の大きさ。`, ans: String.raw`$144^{\circ}$`, exp: String.raw`外角が $360/10 = 36^{\circ}$ なので $180 - 36 = 144^{\circ}$` },
        { text: "五角形の内角の和。", ans: String.raw`$540^{\circ}$`, exp: String.raw`$180 \times (5 - 2) = 540^{\circ}$` },
        { text: String.raw`$y = \frac{12}{x}$ で $x=3$ のときの $y$ の値。`, ans: String.raw`$y = 4$`, exp: String.raw`$12 \div 3 = 4$` },
        { 
            text: String.raw`三角形の内角の和の性質を利用し、$\angle x$ を求めなさい。`, 
            ans: String.raw`$80^{\circ}$`, 
            exp: String.raw`$180 - (60 + 40) = 80^{\circ}$`,
            draw: (brd) => { brd.create('polygon', [[-2,-1],[2,-1],[0,2]]); brd.create('text', [-1.2,-0.7,"60°"]); brd.create('text', [0.8,-0.7,"40°"]); brd.create('text', [-0.2,1.2,"x"]); }
        },
        { text: "1辺 5cm の正方形の対角線の長さ。", ans: String.raw`$5\sqrt{2} \text{ cm}$`, exp: String.raw`$1:1:\sqrt{2}$ の比を利用します。` },
        { text: "底面の半径 3cm、高さ 4cm の円錐の体積。", ans: String.raw`$12\pi \text{ cm}^3$`, exp: String.raw`$9\pi \times 4 \div 3 = 12\pi$` }
    ],
    9: [ // 作図（都立頻出：垂線・二等分線特化）
        { 
            text: String.raw`点Pを通る直線$l$の垂線を作図せよ。`, ans: "垂線", 
            exp: "Pを中心に弧を描き、$l$との交点2つから等距離の点を結びます。",
            draw: (brd) => {
                brd.create('line', [[-3,-1], [3,-1]], {fixed:true, name:'l', withLabel:true});
                brd.create('point', [0,1], {name:'P', fixed:true});
                brd.create('line', [[0,-2],[0,2]], {dash:2, strokeColor:'gray', fixed:true});
            }
        },
        { 
            text: String.raw`線分ABの垂直二等分線を作図せよ。`, ans: "垂直二等分線", 
            exp: "点A, Bから同じ半径で弧を描き、その交点2つを通る直線を引きます。",
            draw: (brd) => {
                brd.create('segment', [[-2,0], [2,0]], {name:'AB', withLabel:true});
                brd.create('line', [[0,-2.5],[0,2.5]], {dash:2, strokeColor:'gray', fixed:true});
            }
        },
        { 
            text: String.raw`$\angle ABC$ の二等分線を作図せよ。`, ans: "角の二等分線", 
            exp: "点Bを中心に弧を描き、2辺との交点から等距離の点を結びます。",
            draw: (brd) => {
                let b = brd.create('point', [-1,-1], {name:'B'});
                brd.create('line', [b, [2,-1]], {fixed:true});
                brd.create('line', [b, [1, 2]], {fixed:true});
                brd.create('line', [b, [2, 0.5]], {dash:2, strokeColor:'gray', fixed:true});
            }
        },
        { 
            text: String.raw`点Aを接点とする、円Oの接線を作図せよ。`, ans: "半径への垂線", 
            exp: "半径OAを引き、点Aを通るOAへの垂線を作図します。",
            draw: (brd) => {
                brd.create('circle', [[0,0], 2], {strokeColor:'#ccc'});
                brd.create('point', [0,0], {name:'O', fixed:true});
                brd.create('point', [2,0], {name:'A', fixed:true});
                brd.create('line', [[2,-2.5],[2,2.5]], {dash:2, strokeColor:'gray', fixed:true});
            }
        },
        { 
            text: String.raw`三角形ABCで、辺BCを底辺とした時の「高さ」を作図せよ。`, ans: "頂点からの垂線", 
            exp: "頂点Aから辺BC（またはその延長線）への垂線を作図します。",
            draw: (brd) => {
                let b = brd.create('point', [-2,-1], {name:'B'});
                let c = brd.create('point', [1,-1], {name:'C'});
                let a = brd.create('point', [-0.5,2], {name:'A'});
                brd.create('polygon', [a,b,c]);
                brd.create('segment', [[-0.5,2], [-0.5,-1]], {dash:2, strokeColor:'red'});
            }
        },
        { 
            text: String.raw`$30^{\circ}$ の角を作図せよ。`, ans: "正三角形の角の二等分", 
            exp: "正三角形を作って $60^{\circ}$ を作り、それを二等分して $30^{\circ}$ にします。",
            draw: (brd) => {
                brd.create('line', [[0,0],[3,0]], {fixed:true});
                brd.create('line', [[0,0],[2.6, 1.5]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: String.raw`2辺 $l, m$ から等しい距離にある点Pを作図せよ。`, ans: "角の二等分線", 
            exp: "「2辺から等距離」は、その2辺が作る角の二等分線上の点です。",
            draw: (brd) => {
                brd.create('line', [[-2,-1],[2,-1]], {name:'l', withLabel:true});
                brd.create('line', [[-2,-1],[1, 2]], {name:'m', withLabel:true});
                brd.create('line', [[-2,-1],[2, 1.5]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: String.raw`2点 A, B から等しい距離にある直線 $l$ 上の点Pを作図せよ。`, ans: "垂直二等分線と $l$ の交点", 
            exp: "ABの垂直二等分線を引き、直線 $l$ との交点をPとします。",
            draw: (brd) => {
                brd.create('point', [-1.5, 1], {name:'A'});
                brd.create('point', [0.5, 2], {name:'B'});
                brd.create('line', [[-3,-1],[3,-0.5]], {name:'l', withLabel:true});
                brd.create('point', [0.2, -0.7], {name:'P', strokeColor:'red'});
            }
        },
        { 
            text: String.raw`線分ABを直径とする円の中心Oを作図せよ。`, ans: "線分の垂直二等分線（中点）", 
            exp: "直径ABの垂直二等分線を引き、ABとの交点を中心Oとします。",
            draw: (brd) => {
                brd.create('segment', [[-2,-1], [2,1]], {name:'AB', withLabel:true});
                brd.create('point', [0,0], {name:'O', strokeColor:'red'});
                brd.create('circle', [[0,0], 2.23], {dash:1, strokeColor:'#ccc'});
            }
        },
        { 
            text: String.raw`$\angle ABC = 90^{\circ}$ となる半直線BCを作図せよ。`, ans: "点Bを通る垂線", 
            exp: "点Bを通る辺ABへの垂線を作図します。",
            draw: (brd) => {
                brd.create('segment', [[0,0], [0,2]], {name:'BA', withLabel:true});
                brd.create('line', [[0,0], [3,0]], {dash:2, strokeColor:'gray'});
            }
        }
    ]
};

function select(cat, btn) {
    currentCat = cat;
    lastIdx = -1;
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadProblem();
}

function loadProblem() {
    const list = database[currentCat];
    if(!list) return;

    let newIdx;
    do { newIdx = Math.floor(Math.random() * list.length); } while (newIdx === lastIdx && list.length > 1);
    lastIdx = newIdx;
    const q = list[newIdx];
    
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    document.getElementById('show-btn').style.display = 'block';

    if(board) JXG.JSXGraph.freeBoard(board);
    const boxEl = document.getElementById('jxgbox');
    if(q.draw) {
        boxEl.style.display = 'block';
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4,4,4,-4], axis:false, showCopyright:false, showNavigation:false});
        q.draw(board);
    } else { boxEl.style.display = 'none'; }
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
    document.getElementById('show-btn').style.display = 'none';
    MathJax.typesetPromise();
}
</script>
</body>
</html>
