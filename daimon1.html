<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問1完全版</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>
        window.MathJax = {
            tex: { inlineMath: [['$', '$']] },
            chtml: { matchFontHeight: false }
        };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fdfdfd; }
        .nav-header { margin-bottom: 10px; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #007AFF; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-btn { padding: 10px; cursor: pointer; border-radius: 8px; border: 1px solid #ddd; background: #fff; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .nav-btn.active { background: #007AFF; color: white; border-color: #007AFF; }
        #prob-text { font-size: 1.25em; line-height: 1.8; margin: 20px 0; min-height: 80px; }
        .jxgbox { width: 100%; height: 300px; margin: 15px 0; display: none; border-radius: 10px; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #34C759; color: white; cursor: pointer; font-weight: bold; }
        .ans-box { display: none; margin-top: 20px; padding: 15px; background: #fef4f4; border-radius: 10px; border: 2px solid #ffcccc; }
    </style>
</head>
<body>

<div class="nav-header">
    <a href="index.html" class="back-link">← メニューに戻る</a>
</div>

<div class="card">
    <div class="nav-grid" id="nav-buttons">
        <button class="nav-btn" onclick="select(1, this)">(1)四則</button>
        <button class="nav-btn" onclick="select(2, this)">(2)文字式</button>
        <button class="nav-btn" onclick="select(3, this)">(3)平方根</button>
        <button class="nav-btn" onclick="select(4, this)">(4)1次方程式</button>
        <button class="nav-btn" onclick="select(5, this)">(5)連立方程式</button>
        <button class="nav-btn" onclick="select(6, this)">(6)2次方程式</button>
        <button class="nav-btn" onclick="select(7, this)">(7)確率</button>
        <button class="nav-btn" onclick="select(8, this)">(8)角度・変域</button>
        <button class="nav-btn" onclick="select(9, this)">(9)作図</button>
    </div>

    <div id="prob-text">項目を選んでください</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()" style="display:none;">答え合わせ</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.3em; color:#d00;"></div>
        <div id="exp" style="margin-top:10px; color:#444; line-height:1.6;"></div>
        <button class="action-btn" style="background:#8E8E93; margin-top:15px;" onclick="loadProblem()">次の問題</button>
    </div>
</div>

<script>
let board = null;
let currentCat = 0;
let lastProbIdx = -1;

const database = {
    1: [ /* 四則 */
        { text: String.raw`$5 + (-3) \times 4$`, ans: String.raw`$-7$`, exp: String.raw`$5 - 12 = -7$` },
        { text: String.raw`$(-6)^2 \div 4 - 10$`, ans: String.raw`$-1$`, exp: String.raw`$36 \div 4 - 10 = 9 - 10 = -1$` },
        { text: String.raw`$8 - 2 \times (-3)^2$`, ans: String.raw`$-10$`, exp: String.raw`$8 - 2 \times 9 = 8 - 18 = -10$` }
    ],
    2: [ /* 文字式 */
        { text: String.raw`$4(x-y) - (3x-2y)$`, ans: String.raw`$x-2y$`, exp: String.raw`$4x-4y-3x+2y = x-2y$` },
        { text: String.raw`$\frac{1}{2}(4a+6b) - 3b$`, ans: String.raw`$2a$`, exp: String.raw`$2a+3b-3b = 2a$` }
    ],
    // ... 中略 ...
    9: [ /* 作図（ここを大幅強化） */
        { 
            text: "線分ABの垂直二等分線を作図せよ。", 
            ans: "垂直二等分線", exp: "A,Bから等しい半径の円を描き、2つの交点を結びます。",
            draw: (brd) => {
                let a = brd.create('point', [-2,0], {name:'A', fixed:true});
                let b = brd.create('point', [2,0], {name:'B', fixed:true});
                brd.create('segment', [a,b]);
                brd.create('line', [[0,-1],[0,1]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: "点Pを通り、直線Lに垂直な線（垂線）を作図せよ。", 
            ans: "垂線", exp: "PからLに弧を描き、Lとの交点2つから等距離の点を探します。",
            draw: (brd) => {
                let l = brd.create('line', [[-3,-1],[3,-1]], {name:'L', withLabel:true, fixed:true});
                let p = brd.create('point', [0,1], {name:'P', fixed:true});
                brd.create('line', [[0,-1],[0,2]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: "角ABCの二等分線を作図せよ。", 
            ans: "角の二等分線", exp: "Bを中心とした弧を描き、辺AB,BCとの交点から等距離の点を結びます。",
            draw: (brd) => {
                let b = brd.create('point', [-1,-1], {name:'B', fixed:true});
                let a = brd.create('point', [-1,2], {name:'A', fixed:true});
                let c = brd.create('point', [2,-1], {name:'C', fixed:true});
                brd.create('segment', [b,a]); brd.create('segment', [b,c]);
                brd.create('line', [b, [1,1]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: "点Aを通り、半直線ABに対して30度の角を作図せよ。", 
            ans: "30度の作図", exp: "正三角形（60度）を作図し、その角を二等分します。",
            draw: (brd) => {
                let a = brd.create('point', [0,0], {name:'A', fixed:true});
                let b = brd.create('point', [3,0], {name:'B', fixed:true});
                brd.create('segment', [a,b]);
                brd.create('line', [a, [2, 1.15]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: "3点A,B,Cを通る円の中心Oを作図せよ。", 
            ans: "円の中心", exp: "ABとBCの垂直二等分線をそれぞれ描き、その交点が中心Oです。",
            draw: (brd) => {
                let a = brd.create('point', [-1,2], {name:'A', fixed:true});
                let b = brd.create('point', [2,1], {name:'B', fixed:true});
                let c = brd.create('point', [0,-2], {name:'C', fixed:true});
                brd.create('point', [0.1, 0.1], {name:'O', strokeColor:'red', dash:2});
            }
        }
    ]
};

// 既存の1-8も同様に保持（簡易化のため上記では省略していますが、お持ちのコードをそのまま使えます）

function select(cat, btn) {
    currentCat = cat;
    lastProbIdx = -1; // カテゴリが変わったらリセット
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadProblem();
}

function loadProblem() {
    const list = database[currentCat];
    if(!list) return;

    let newIdx;
    do {
        newIdx = Math.floor(Math.random() * list.length);
    } while (newIdx === lastProbIdx && list.length > 1); // 2問以上あれば連続を避ける

    lastProbIdx = newIdx;
    const q = list[newIdx];
    
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    document.getElementById('show-btn').style.display = 'block';

    if(board) JXG.JSXGraph.freeBoard(board);
    const boxEl = document.getElementById('jxgbox');
    if(q.draw) {
        boxEl.style.display = 'block';
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4,4,4,-4], axis:false, showCopyright:false, showNavigation:false});
        q.draw(board);
    } else { boxEl.style.display = 'none'; }
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
    document.getElementById('show-btn').style.display = 'none';
    MathJax.typesetPromise();
}
</script>
</body>
</html>
