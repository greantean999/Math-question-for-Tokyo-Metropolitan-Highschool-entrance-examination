<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問1完全版</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$']] }, chtml: { matchFontHeight: false } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fdfdfd; }
        .nav-header { margin-bottom: 10px; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #007AFF; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-btn { padding: 10px; cursor: pointer; border-radius: 8px; border: 1px solid #ddd; background: #fff; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .nav-btn.active { background: #007AFF; color: white; border-color: #007AFF; }
        #prob-text { font-size: 1.25em; line-height: 1.8; margin: 20px 0; min-height: 80px; }
        .jxgbox { width: 100%; height: 300px; margin: 15px 0; display: none; border-radius: 10px; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #34C759; color: white; cursor: pointer; font-weight: bold; }
        .ans-box { display: none; margin-top: 20px; padding: 15px; background: #fef4f4; border-radius: 10px; border: 2px solid #ffcccc; }
    </style>
</head>
<body>

<div class="nav-header">
    <a href="index.html" class="back-link">← メニューに戻る</a>
</div>

<div class="card">
    <div class="nav-grid">
        <button class="nav-btn" onclick="select(1, this)">(1)四則</button>
        <button class="nav-btn" onclick="select(2, this)">(2)文字式</button>
        <button class="nav-btn" onclick="select(3, this)">(3)平方根</button>
        <button class="nav-btn" onclick="select(4, this)">(4)1次方程式</button>
        <button class="nav-btn" onclick="select(5, this)">(5)連立方程式</button>
        <button class="nav-btn" onclick="select(6, this)">(6)2次方程式</button>
        <button class="nav-btn" onclick="select(7, this)">(7)確率</button>
        <button class="nav-btn" onclick="select(8, this)">(8)角度・変域</button>
        <button class="nav-btn" onclick="select(9, this)">(9)作図</button>
    </div>

    <div id="prob-text">学習したい項目を選んでください。</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()" style="display:none;">答え合わせ</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.4em; color:#d00; border-bottom:1px solid #ffcccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.8; margin-top: 10px; background: white; padding: 10px; border-radius: 5px;"></div>
        <button class="action-btn" style="background:#8E8E93; margin-top:15px;" onclick="loadProblem()">次の問題</button>
    </div>
</div>

<script>
let board = null;
let currentCat = 0;
let lastIdx = -1;

const database = {
    1: [ // 四則・計算
        { text: String.raw`$1 + 6 \times (-2)$`, ans: String.raw`$-11$`, exp: String.raw`$1 - 12 = -11$` },
        { text: String.raw`$(-4)^2 + 9 \div (-3)$`, ans: String.raw`$13$`, exp: String.raw`$16 - 3 = 13$` },
        { text: String.raw`$5 - (-2)^3 \times 2$`, ans: String.raw`$21$`, exp: String.raw`$5 - (-8) \times 2 = 5 + 16 = 21$` },
        { text: String.raw`$(-7) \times 4 + 15$`, ans: String.raw`$-13$`, exp: String.raw`$-28 + 15 = -13$` },
        { text: String.raw`$3 \times (-2)^2 - 10$`, ans: String.raw`$2$`, exp: String.raw`$3 \times 4 - 10 = 12 - 10 = 2$` },
        { text: String.raw`$(-6)^2 \div 4 - 8$`, ans: String.raw`$1$`, exp: String.raw`$36 \div 4 - 8 = 9 - 8 = 1$` },
        { text: String.raw`$7 - 3 \times (-4)$`, ans: String.raw`$19$`, exp: String.raw`$7 + 12 = 19$` },
        { text: String.raw`$(-9) + 4 \times (-2)$`, ans: String.raw`$-17$`, exp: String.raw`$-9 - 8 = -17$` },
        { text: String.raw`$(-2)^2 - (-5) \times 3$`, ans: String.raw`$19$`, exp: String.raw`$4 + 15 = 19$` },
        { text: String.raw`$6 \div (-2) + (-3)^2$`, ans: String.raw`$6$`, exp: String.raw`$-3 + 9 = 6$` }
    ],
    2: [ // 文字式
        { text: String.raw`$4(x-y) - (3x-2y)$`, ans: String.raw`$x-2y$`, exp: String.raw`$4x-4y-3x+2y = x-2y$` },
        { text: String.raw`$5a + 3b - 2(a - 2b)$`, ans: String.raw`$3a + 7b$`, exp: String.raw`$5a + 3b - 2a + 4b = 3a + 7b$` },
        { text: String.raw`$\frac{1}{2}(4x-6y) + 3y$`, ans: String.raw`$2x$`, exp: String.raw`$2x - 3y + 3y = 2x$` },
        { text: String.raw`$7a - b - 4(a - 2b)$`, ans: String.raw`$3a + 7b$`, exp: String.raw`$7a - b - 4a + 8b = 3a + 7b$` },
        { text: String.raw`$12x^2y \div 4xy \times 2x$`, ans: String.raw`$6x^2$`, exp: String.raw`$3x \times 2x = 6x^2$` },
        { text: String.raw`$3(2a-b) - 5(a-b)$`, ans: String.raw`$a+2b$`, exp: String.raw`$6a-3b-5a+5b = a+2b$` },
        { text: String.raw`$(15x-10y) \div 5 + 2y$`, ans: String.raw`$3x$`, exp: String.raw`$3x-2y+2y = 3x$` },
        { text: String.raw`$4(x+y) - 3(x-y)$`, ans: String.raw`$x+7y$`, exp: String.raw`$4x+4y-3x+3y = x+7y$` },
        { text: String.raw`$\frac{2a-b}{3} \times 9 - 5a$`, ans: String.raw`$a-3b$`, exp: String.raw`$3(2a-b) - 5a = 6a-3b-5a = a-3b$` },
        { text: String.raw`$x^2 - 3x - (x^2 - 5x)$`, ans: String.raw`$2x$`, exp: String.raw`$x^2-3x-x^2+5x = 2x$` }
    ],
    3: [ // 平方根
        { text: String.raw`$\sqrt{27} - \sqrt{12}$`, ans: String.raw`$\sqrt{3}$`, exp: String.raw`$3\sqrt{3} - 2\sqrt{3} = \sqrt{3}$` },
        { text: String.raw`$\sqrt{50} + \sqrt{18}$`, ans: String.raw`$8\sqrt{2}$`, exp: String.raw`$5\sqrt{2} + 3\sqrt{2} = 8\sqrt{2}$` },
        { text: String.raw`$\frac{10}{\sqrt{5}} - \sqrt{5}$`, ans: String.raw`$\sqrt{5}$`, exp: String.raw`$2\sqrt{5} - \sqrt{5} = \sqrt{5}$` },
        { text: String.raw`$(\sqrt{3}+2)(\sqrt{3}-2)$`, ans: String.raw`$-1$`, exp: String.raw`$3 - 4 = -1$` },
        { text: String.raw`$\sqrt{2}(\sqrt{8} + \sqrt{18})$`, ans: String.raw`$10$`, exp: String.raw`$\sqrt{16} + \sqrt{36} = 4 + 6 = 10$` },
        { text: String.raw`$(\sqrt{7}+1)^2 - \sqrt{28}$`, ans: String.raw`$8$`, exp: String.raw`$7 + 2\sqrt{7} + 1 - 2\sqrt{7} = 8$` },
        { text: String.raw`$\frac{\sqrt{48}}{\sqrt{3}} - \sqrt{9}$`, ans: String.raw`$1$`, exp: String.raw`$\sqrt{16} - 3 = 4 - 3 = 1$` },
        { text: String.raw`$\sqrt{2} \times \sqrt{6} + \sqrt{3}$`, ans: String.raw`$3\sqrt{3}$`, exp: String.raw`$\sqrt{12} + \sqrt{3} = 2\sqrt{3} + \sqrt{3} = 3\sqrt{3}$` },
        { text: String.raw`$(\sqrt{6}+\sqrt{2})(\sqrt{6}-\sqrt{2})$`, ans: String.raw`$4$`, exp: String.raw`$6 - 2 = 4$` },
        { text: String.raw`$\sqrt{20} - \frac{5}{\sqrt{5}}$`, ans: String.raw`$\sqrt{5}$`, exp: String.raw`$2\sqrt{5} - \sqrt{5} = \sqrt{5}$` }
    ],
    // 長くなるのでまずは(1)〜(3)の30問を！ 
    // 反映されたら(4)〜(9)も送ります。
};

function select(cat, btn) {
    currentCat = cat;
    lastIdx = -1;
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadProblem();
}

function loadProblem() {
    const list = database[currentCat];
    if(!list) return;

    let newIdx;
    do { newIdx = Math.floor(Math.random() * list.length); } while (newIdx === lastIdx && list.length > 1);
    lastIdx = newIdx;
    const q = list[newIdx];
    
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    document.getElementById('show-btn').style.display = 'block';

    if(board) JXG.JSXGraph.freeBoard(board);
    const boxEl = document.getElementById('jxgbox');
    if(q.draw) {
        boxEl.style.display = 'block';
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4,4,4,-4], axis:false, showCopyright:false, showNavigation:false});
        q.draw(board);
    } else { boxEl.style.display = 'none'; }
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
    document.getElementById('show-btn').style.display = 'none';
    MathJax.typesetPromise();
}
</script>
</body>
</html>
