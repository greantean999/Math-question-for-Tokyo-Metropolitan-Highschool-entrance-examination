<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問1完全版</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$']] }, chtml: { matchFontHeight: false } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fdfdfd; }
        .nav-header { margin-bottom: 10px; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #007AFF; }
        .nav-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .nav-btn { padding: 10px; cursor: pointer; border-radius: 8px; border: 1px solid #ddd; background: #fff; font-weight: bold; font-size: 13px; transition: 0.2s; }
        .nav-btn.active { background: #007AFF; color: white; border-color: #007AFF; }
        #prob-text { font-size: 1.25em; line-height: 1.8; margin: 20px 0; min-height: 80px; }
        .jxgbox { width: 100%; height: 300px; margin: 15px 0; display: none; border-radius: 10px; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #34C759; color: white; cursor: pointer; font-weight: bold; }
        .ans-box { display: none; margin-top: 20px; padding: 15px; background: #fef4f4; border-radius: 10px; border: 2px solid #ffcccc; }
    </style>
</head>
<body>

<div class="nav-header">
    <a href="index.html" class="back-link">← メニューに戻る</a>
</div>

<div class="card">
    <div class="nav-grid">
        <button class="nav-btn" onclick="select(1, this)">(1)四則</button>
        <button class="nav-btn" onclick="select(2, this)">(2)文字式</button>
        <button class="nav-btn" onclick="select(3, this)">(3)平方根</button>
        <button class="nav-btn" onclick="select(4, this)">(4)1次方程式</button>
        <button class="nav-btn" onclick="select(5, this)">(5)連立方程式</button>
        <button class="nav-btn" onclick="select(6, this)">(6)2次方程式</button>
        <button class="nav-btn" onclick="select(7, this)">(7)確率</button>
        <button class="nav-btn" onclick="select(8, this)">(8)角度・変域</button>
        <button class="nav-btn" onclick="select(9, this)">(9)作図</button>
    </div>

    <div id="prob-text">学習したい項目を選んでください。</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()" style="display:none;">答え合わせ</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.4em; color:#d00; border-bottom:1px solid #ffcccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.8; margin-top: 10px; background: white; padding: 10px; border-radius: 5px;"></div>
        <button class="action-btn" style="background:#8E8E93; margin-top:15px;" onclick="loadProblem()">次の問題</button>
    </div>
</div>

<script>
let board = null;
let currentCat = 0;
let lastIdx = -1;

const database = {
    1: [
        { text: String.raw`$(-4)^2 + 6 \div (-2)$`, ans: String.raw`$13$`, exp: String.raw`$16 + (-3) = 13$` },
        { text: String.raw`$5 - 2 \times (-4)$`, ans: String.raw`$13$`, exp: String.raw`$5 - (-8) = 13$` },
        { text: String.raw`$(-3) \times 7 + 10$`, ans: String.raw`$-11$`, exp: String.raw`$-21 + 10 = -11$` },
        { text: String.raw`$8 - (-3)^2$`, ans: String.raw`$-1$`, exp: String.raw`$8 - 9 = -1$` },
        { text: String.raw`$(-6)^2 \div 9 - 4$`, ans: String.raw`$0$`, exp: String.raw`$36 \div 9 - 4 = 0$` }
    ],
    2: [
        { text: String.raw`$3(x - 2y) - 2(2x - y)$`, ans: String.raw`$-x - 4y$`, exp: String.raw`$3x - 6y - 4x + 2y = -x - 4y$` },
        { text: String.raw`$4a + 5b - (2a - b)$`, ans: String.raw`$2a + 6b$`, exp: String.raw`$4a + 5b - 2a + b = 2a + 6b$` },
        { text: String.raw`$8x^2y \div 4x$`, ans: String.raw`$2xy$`, exp: String.raw`数字は $8 \div 4=2$ 、文字は $x^2y \div x = xy$` }
    ],
    3: [
        { text: String.raw`$\sqrt{18} + \sqrt{8}$`, ans: String.raw`$5\sqrt{2}$`, exp: String.raw`$3\sqrt{2} + 2\sqrt{2} = 5\sqrt{2}$` },
        { text: String.raw`$(\sqrt{5}+1)(\sqrt{5}-1)$`, ans: String.raw`$4$`, exp: String.raw`$(\sqrt{5})^2 - 1^2 = 5 - 1 = 4$` },
        { text: String.raw`$\frac{6}{\sqrt{3}} - \sqrt{3}$`, ans: String.raw`$\sqrt{3}$`, exp: String.raw`有理化して $2\sqrt{3} - \sqrt{3} = \sqrt{3}$` }
    ],
    4: [
        { text: String.raw`$4x - 7 = x + 5$`, ans: String.raw`$x = 4$`, exp: String.raw`$3x = 12 \Rightarrow x = 4$` },
        { text: String.raw`$2(x - 3) = 10$`, ans: String.raw`$x = 8$`, exp: String.raw`$2x - 6 = 10 \Rightarrow 2x = 16$` }
    ],
    5: [
        { text: String.raw`$\begin{cases} x+y=5 \\ x-y=1 \end{cases}$`, ans: String.raw`$x=3, y=2$`, exp: String.raw`加減法で $2x=6 \Rightarrow x=3$ 、代入して $y=2$` }
    ],
    6: [
        { text: String.raw`$x^2 - 5x + 6 = 0$`, ans: String.raw`$x=2, 3$`, exp: String.raw`$(x-2)(x-3)=0$ より $x=2, 3$` },
        { text: String.raw`$x^2 + 2x - 1 = 0$`, ans: String.raw`$x=-1 \pm \sqrt{2}$`, exp: String.raw`解の公式 $x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$ を使用。` }
    ],
    7: [
        { text: "サイコロを2度振る時、出た目の和が7になる確率。", ans: String.raw`$\frac{1}{6}$`, exp: String.raw`(1,6),(2,5),(3,4),(4,3),(5,2),(6,1)の6通り。$6/36 = 1/6$` }
    ],
    8: [
        { text: String.raw`$y=x^2$ で $x$ の変域が $-2 \le x \le 3$ のときの $y$ の変域。`, ans: String.raw`$0 \le y \le 9$`, exp: String.raw`$x=0$ を通るので最小値は $0$ 、最大値は $3^2=9$` },
        { text: "正八角形の1つの外角の大きさ。", ans: String.raw`$45^{\circ}$`, exp: String.raw`$360 \div 8 = 45$` }
    ],
    9: [
        { 
            text: "線分ABの垂直二等分線を作図せよ。", ans: "垂直二等分線", exp: "A, Bから等しい半径の円を描き、その交点を結びます。",
            draw: (brd) => {
                let a = brd.create('point', [-2,0], {name:'A', fixed:true});
                let b = brd.create('point', [2,0], {name:'B', fixed:true});
                brd.create('segment', [a,b]);
                brd.create('line', [[0,-2],[0,2]], {dash:2, strokeColor:'gray'});
            }
        },
        { 
            text: "角ABCの二等分線を作図せよ。", ans: "角の二等分線", exp: "Bを中心とした弧を描き、辺との交点からさらに等距離の点を結びます。",
            draw: (brd) => {
                let b = brd.create('point', [-1,-1], {name:'B', fixed:true});
                let a = brd.create('point', [-1,2], {name:'A', fixed:true});
                let c = brd.create('point', [2,-1], {name:'C', fixed:true});
                brd.create('segment', [b,a]); brd.create('segment', [b,c]);
                brd.create('line', [b, [1,1]], {dash:2, strokeColor:'gray'});
            }
        }
    ]
};

function select(cat, btn) {
    currentCat = cat;
    lastIdx = -1;
    document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    loadProblem();
}

function loadProblem() {
    const list = database[currentCat];
    if(!list) return;

    let newIdx;
    do { newIdx = Math.floor(Math.random() * list.length); } while (newIdx === lastIdx && list.length > 1);
    lastIdx = newIdx;
    const q = list[newIdx];
    
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    document.getElementById('show-btn').style.display = 'block';

    if(board) JXG.JSXGraph.freeBoard(board);
    const boxEl = document.getElementById('jxgbox');
    if(q.draw) {
        boxEl.style.display = 'block';
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4,4,4,-4], axis:false, showCopyright:false, showNavigation:false});
        q.draw(board);
    } else { boxEl.style.display = 'none'; }
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
    document.getElementById('show-btn').style.display = 'none';
    MathJax.typesetPromise();
}
</script>
</body>
</html>
