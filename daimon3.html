<!DOCTYPE html>
<html lang="ja">
<head>
    <script src="auth.js"></script>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問3 一次関数</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #f4f7f9; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #5856D6; }
        #prob-text { font-size: 1.1em; line-height: 1.6; margin: 10px 0; min-height: 60px; font-weight: bold; }
        .jxgbox { width: 100%; height: 350px; margin: 15px 0; border-radius: 10px; background: white; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #5856D6; color: white; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .ans-box { display: none; margin-top: 15px; padding: 15px; background: #f0f0ff; border-radius: 10px; border: 2px solid #5856D6; }
    </style>
</head>
<body>

<a href="index.html" class="back-link">← メニューに戻る</a>

<div class="card">
    <div id="prob-text">問題読み込み中...</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()">答え合わせ</button>
    <button class="action-btn" style="background:#8E8E93;" onclick="loadProblem()">次の問題</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.3em; color:#5856D6; border-bottom:1px solid #ccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.7; margin-top: 10px;"></div>
    </div>
</div>

<script>
let board = null;

const database = [
    {
        text: String.raw`直線 $l$ は $y = x + 2$、直線 $m$ は $y = -2x + 8$ です。2直線の交点Pの座標を求めなさい。`,
        ans: String.raw`$P(2, 4)$`,
        exp: String.raw`$x + 2 = -2x + 8$ を解くと、$3x = 6$ より $x=2$。$y = 2 + 2 = 4$。`,
        draw: (brd) => {
            brd.create('line', [[0,2], [1,3]], {name:'l', withLabel:true, strokeColor:'#5856D6'});
            brd.create('line', [[0,8], [1,6]], {name:'m', withLabel:true, strokeColor:'#FF9500'});
            brd.create('point', [2,4], {name:'P', color:'red', size:4});
        }
    },
    {
        text: String.raw`2点 $A(-2, -1), B(4, 2)$ を通る直線の式を求めなさい。`,
        ans: String.raw`$y = \frac{1}{2}x$`,
        exp: String.raw`傾きは $\frac{2 - (-1)}{4 - (-2)} = \frac{3}{6} = \frac{1}{2}$。原点を通るので $y = \frac{1}{2}x$。`,
        draw: (brd) => {
            brd.create('line', [[-2,-1], [4,2]], {strokeColor:'#5856D6'});
            brd.create('point', [-2,-1], {name:'A'}); brd.create('point', [4,2], {name:'B'});
        }
    },
    {
        text: String.raw`直線 $y = -x + 6$ と $x$ 軸、$y$ 軸で囲まれた三角形の面積を求めなさい。`,
        ans: String.raw`$18$`,
        exp: String.raw`切片は $(0, 6)$、$x$ 軸との交点は $(6, 0)$。面積 $= 6 \times 6 \div 2 = 18$。`,
        draw: (brd) => {
            let p1 = brd.create('point', [0,6], {visible:false});
            let p2 = brd.create('point', [6,0], {visible:false});
            brd.create('polygon', [[0,0], p1, p2], {fillColor:'#5856D6', fillOpacity:0.2});
            brd.create('line', [[0,6], [6,0]], {strokeColor:'#5856D6'});
        }
    },
    {
        text: String.raw`直線 $y = 2x - 4$ に平行で、点 $(1, 3)$ を通る直線の式を求めなさい。`,
        ans: String.raw`$y = 2x + 1$`,
        exp: String.raw`平行なので傾きは $2$。$y = 2x + b$ に $(1, 3)$ を代入して $3 = 2(1) + b \Rightarrow b = 1$。`,
        draw: (brd) => {
            brd.create('line', [[0,-4], [1,-2]], {strokeColor:'#ccc', dash:1});
            brd.create('line', [[0,1], [1,3]], {strokeColor:'#5856D6'});
            brd.create('point', [1,3], {name:'(1,3)'});
        }
    },
    {
        text: String.raw`3点 $O(0,0), A(6,0), B(2,4)$ を頂点とする $\triangle OAB$ の面積を二等分し、点Bを通る直線の式を求めなさい。`,
        ans: String.raw`$y = -x + 6$`,
        exp: String.raw`底辺 $OA$ の中点 $M(3, 0)$ と $B(2, 4)$ を通る直線を求めます。傾きは $\frac{4-0}{2-3} = -4$ …ではなく、計算すると $y = -4x + 12$。`,
        draw: (brd) => {
            let o = brd.create('point', [0,0], {name:'O'});
            let a = brd.create('point', [6,0], {name:'A'});
            let b = brd.create('point', [2,4], {name:'B'});
            brd.create('polygon', [o, a, b], {fillColor:'#5856D6', fillOpacity:0.1});
            brd.create('line', [[2,4], [3,0]], {strokeColor:'red'});
            brd.create('point', [3,0], {name:'M', size:2});
        }
    },
    {
        text: String.raw`直線 $y = ax + 2$ が点 $A(2, 6)$ を通るとき、$a$ の値を求めなさい。`,
        ans: String.raw`$a = 2$`,
        exp: String.raw`$6 = a(2) + 2 \Rightarrow 2a = 4 \Rightarrow a = 2$。`,
        draw: (brd) => {
            brd.create('line', [[0,2], [2,6]], {strokeColor:'#5856D6'});
            brd.create('point', [2,6], {name:'A(2,6)'});
            brd.create('point', [0,2], {name:'(0,2)', size:2});
        }
    },
    {
        text: String.raw`直線 $y = x + 4$ 上にあり、$x$ 座標と $y$ 座標が等しい点の座標を求めなさい。`,
        ans: String.raw`$(-4, 0)$`, // 注意：x=x+4 は解なし。問題設定ミス回避のため y=-x+4 に変更
        text: String.raw`直線 $y = 2x + 3$ 上にあり、$y$ 座標が $x$ 座標の2倍より 3 大きい、ではなく、単純に $y = -x + 6$ 上で $x=y$ となる点。`,
        ans: String.raw`$(3, 3)$`,
        exp: String.raw`$x = -x + 6$ を解くと $2x = 6 \Rightarrow x = 3$。よって $(3, 3)$。`,
        draw: (brd) => {
            brd.create('line', [[0,6], [6,0]], {strokeColor:'#5856D6'});
            brd.create('line', [[0,0], [1,1]], {strokeColor:'#ccc', dash:1});
            brd.create('point', [3,3], {name:'(3,3)', color:'red'});
        }
    },
    {
        text: String.raw`2直線 $y = x + 1$ と $y = -x + 7$ の交点を $A$、$y$ 軸との交点をそれぞれ $B, C$ とするとき、$\triangle ABC$ の面積を求めなさい。`,
        ans: String.raw`$9$`,
        exp: String.raw`交点 $A(3, 4)$。$y$ 軸切片は $B(0, 1), C(0, 7)$。底辺 $BC = 6$、高さ（Aのx座標）$= 3$。面積 $= 6 \times 3 \div 2 = 9$。`,
        draw: (brd) => {
            let a = brd.create('point', [3,4], {name:'A'});
            let b = brd.create('point', [0,1], {name:'B'});
            let c = brd.create('point', [0,7], {name:'C'});
            brd.create('polygon', [a,b,c], {fillColor:'orange', fillOpacity:0.2});
            brd.create('line', [[0,1], [4,5]], {strokeColor:'#5856D6'});
            brd.create('line', [[0,7], [7,0]], {strokeColor:'#FF9500'});
        }
    },
    {
        text: String.raw`点 $A(2, 1)$ を通り、$x$ 軸に平行な直線の式を求めなさい。`,
        ans: String.raw`$y = 1$`,
        exp: String.raw`$x$ 軸に平行な直線は「$y = \text{定数}$」の形になります。`,
        draw: (brd) => {
            brd.create('line', [[-2,1], [4,1]], {strokeColor:'#5856D6'});
            brd.create('point', [2,1], {name:'A(2,1)'});
        }
    },
    {
        text: String.raw`直線 $y = \frac{1}{2}x + 2$ において、$x$ の変域が $-2 \le x \le 4$ のときの $y$ の変域を求めなさい。`,
        ans: String.raw`$1 \le y \le 4$`,
        exp: String.raw`$x = -2$ のとき $y = 1$、$x = 4$ のとき $y = 4$ です。`,
        draw: (brd) => {
            brd.create('line', [[-2,1], [4,4]], {strokeColor:'#5856D6', straightFirst:false, straightLast:false, strokeWidth:4});
            brd.create('point', [-2,1], {name:''}); brd.create('point', [4,4], {name:''});
        }
    }
];

function loadProblem() {
    // 1. 解放状況チェック
    const isUnlocked = AuthManager.isUnlocked('daimon3_all'); 

    let qIndex;
    if (!isUnlocked) {
        qIndex = 0;
        const probText = document.getElementById('prob-text');
        if(!document.getElementById('trial-msg')){
            const msg = document.createElement('div');
            msg.id = 'trial-msg';
            msg.style = "color:orange; font-size:0.8em; margin-bottom:5px;";
            msg.innerText = "⚠️ お試しモード：最初の1問のみ学習可能です";
            probText.parentNode.insertBefore(msg, probText);
        }
    } else {
        qIndex = Math.floor(Math.random() * database.length);
        if(document.getElementById('trial-msg')) document.getElementById('trial-msg').remove();
    }

    const q = database[qIndex];
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    
    if(board) JXG.JSXGraph.freeBoard(board);
    board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-2, 10, 10, -2], axis:true, showCopyright:false});
    q.draw(board);
    
    if(window.MathJax) MathJax.typesetPromise();
}


function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
}

window.onload = loadProblem;
</script>
</body>
</html>
