<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問3 一次関数</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #f4f7f9; }
        .back-link { text-decoration: none; color: #007AFF; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #5856D6; }
        #prob-text { font-size: 1.1em; line-height: 1.6; margin: 10px 0; min-height: 60px; font-weight: bold; }
        .jxgbox { width: 100%; height: 350px; margin: 15px 0; border-radius: 10px; background: white; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #5856D6; color: white; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .ans-box { display: none; margin-top: 15px; padding: 15px; background: #f0f0ff; border-radius: 10px; border: 2px solid #5856D6; }
    </style>
</head>
<body>

<a href="index.html" class="back-link">← メニューに戻る</a>

<div class="card">
    <div id="prob-text">問題読み込み中...</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()">答え合わせ</button>
    <button class="action-btn" style="background:#8E8E93;" onclick="loadProblem()">次の問題</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.3em; color:#5856D6; border-bottom:1px solid #ccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.7; margin-top: 10px;"></div>
    </div>
</div>

<script>
let board = null;

const database = [
    {
        text: String.raw`直線 $l$ は $y = x + 2$、直線 $m$ は $y = -2x + 8$ です。2直線の交点Pの座標を求めなさい。`,
        ans: String.raw`$P(2, 4)$`,
        exp: String.raw`$x + 2 = -2x + 8$ を解くと、$3x = 6$ より $x=2$。$y = 2 + 2 = 4$。`,
        draw: (brd) => {
            brd.create('grid', []);
            brd.create('axis', [[0,0], [1,0]]); brd.create('axis', [[0,0], [0,1]]);
            brd.create('line', [[0,2], [1,3]], {name:'l', withLabel:true, strokeColor:'#5856D6'});
            brd.create('line', [[0,8], [1,6]], {name:'m', withLabel:true, strokeColor:'#FF9500'});
            brd.create('point', [2,4], {name:'P', color:'red'});
        }
    },
    {
        text: String.raw`2点 $A(-2, -1), B(4, 2)$ を通る直線の式を求めなさい。`,
        ans: String.raw`$y = \frac{1}{2}x$`,
        exp: String.raw`傾きは $\frac{2 - (-1)}{4 - (-2)} = \frac{3}{6} = \frac{1}{2}$。原点を通るので $y = \frac{1}{2}x$。`,
        draw: (brd) => {
            brd.create('grid', []); brd.create('axis', [[0,0], [1,0]]); brd.create('axis', [[0,0], [0,1]]);
            brd.create('line', [[-2,-1], [4,2]], {strokeColor:'#5856D6'});
            brd.create('point', [-2,-1], {name:'A'}); brd.create('point', [4,2], {name:'B'});
        }
    },
    {
        text: String.raw`直線 $y = -x + 6$ と $x$ 軸、$y$ 軸で囲まれた三角形の面積を求めなさい。`,
        ans: String.raw`$18$`,
        exp: String.raw`切片は $(0, 6)$、$x$ 軸との交点は $(6, 0)$。底辺 $6 \times$ 高さ $6 \div 2 = 18$。`,
        draw: (brd) => {
            brd.create('grid', []); brd.create('axis', [[0,0], [1,0]]); brd.create('axis', [[0,0], [0,1]]);
            let p1 = brd.create('point', [0,6], {visible:false});
            let p2 = brd.create('point', [6,0], {visible:false});
            let origin = brd.create('point', [0,0], {visible:false});
            brd.create('polygon', [origin, p1, p2], {fillColor:'#5856D6', fillOpacity:0.2});
            brd.create('line', [[0,6], [6,0]], {strokeColor:'#5856D6'});
        }
    }
];

function loadProblem() {
    const q = database[Math.floor(Math.random() * database.length)];
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    
    if(board) JXG.JSXGraph.freeBoard(board);
    board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-2, 10, 10, -2], axis:true, showCopyright:false});
    q.draw(board);
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
}

window.onload = loadProblem;
</script>
</body>
</html>
