<!DOCTYPE html>
<html lang="ja">
<head>
    <script src="auth.js"></script>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問1(7) 角度・図形</title>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css">
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #fdf6e3; }
        .back-link { text-decoration: none; color: #268bd2; font-weight: bold; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        .prob-text { font-size: 1.1rem; margin: 20px 0; min-height: 50px; color: #073642; text-align: left; }
        #jxgbox { width: 100%; height: 300px; margin: auto; border-radius: 10px; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #268bd2; color: white; cursor: pointer; font-weight: bold; margin: 10px 0; }
        .ans-box { display: none; margin-top: 20px; padding: 20px; background: #eee8d5; border-radius: 10px; border: 2px solid #268bd2; }
    </style>
</head>
<body>

<a href="daimon1.html" class="back-link">← 大問1メニューへ</a>

<div class="card">
    <div id="prob-text" class="prob-text">読み込み中...</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button class="action-btn" onclick="showAnswer()">答えを表示</button>
    <button class="action-btn" style="background:#859900;" onclick="nextProblem()">次の問題</button>

    <div id="ans-area" class="ans-box">
        <div id="ans-text" style="font-size: 1.4rem; font-weight: bold; color: #d33682; margin-bottom: 10px;"></div>
        <div id="exp-text" style="text-align: left; font-size: 0.9rem;"></div>
    </div>
</div>

<script>
    let board;
    const database = [
        { 
            q: String.raw`下の図で、$l // m$ のとき、$\angle x$ の大きさを求めなさい。`, 
            a: String.raw`$105^\circ$`, 
            e: String.raw`平行線の間に「くの字」の線があるときは、頂点を通る平行線をもう一本引いて考えます。錯角を利用して $45^\circ + 60^\circ = 105^\circ$ となります。`,
            draw: (brd) => {
                brd.create('line', [[-1, 2], [5, 2]], {name:'l', withLabel:true, strokeColor:'#666'});
                brd.create('line', [[-1, -2], [5, -2]], {name:'m', withLabel:true, strokeColor:'#666'});
                let p1 = brd.create('point', [0, 2], {visible:false});
                let p2 = brd.create('point', [2, 0], {name:'x', strokeColor:'red'});
                let p3 = brd.create('point', [0, -2], {visible:false});
                brd.create('segment', [p1, p2]); brd.create('segment', [p2, p3]);
                brd.create('text', [0.3, 1.7, "45°"]); brd.create('text', [0.3, -1.7, "60°"]);
            }
        },
        { 
            q: String.raw`正五角形の一つの内角の大きさを求めなさい。`, 
            a: String.raw`$108^\circ$`, 
            e: String.raw`多角形の内角の和は $180 \times (n - 2)$ です。正五角形なら $180 \times 3 = 540$。一つ分は $540 \div 5 = 108^\circ$ です。`,
            draw: (brd) => {
                brd.create('regularpolygon', [[1, -1.5], [3, -1.5], 5], {fillOpacity:0.1});
            }
        },
        { 
            q: String.raw`下の図で、$\angle x$ の大きさを求めなさい。`, 
            a: String.raw`$50^\circ$`, 
            e: String.raw`円周角の定理より、同じ弧に対する中心角は円周角の2倍です。$100 \div 2 = 50^\circ$ です。`,
            draw: (brd) => {
                let c = brd.create('circle', [[2, 0], 2], {strokeColor:'#666'});
                let center = brd.create('point', [2, 0], {name:'O', size:2});
                let p1 = brd.create('point', [0.2, 0.8], {visible:false});
                let p2 = brd.create('point', [3.8, 0.8], {visible:false});
                let p3 = brd.create('point', [2, 2], {name:'x'});
                brd.create('segment', [center, p1]); brd.create('segment', [center, p2]);
                brd.create('segment', [p1, p3]); brd.create('segment', [p3, p2]);
                brd.create('text', [1.8, 0.4, "100°"]);
            }
        }
    ];

    let currentProb = null;

    function nextProblem() {
        const isUnlocked = AuthManager.isUnlocked('daimon1_q7');
        let qIndex = isUnlocked ? Math.floor(Math.random() * database.length) : 0;
        currentProb = database[qIndex];
        
        document.getElementById('prob-text').innerHTML = currentProb.q;
        document.getElementById('ans-area').style.display = 'none';

        if(board) JXG.JSXGraph.freeBoard(board);
        board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-1, 3, 5, -3], axis:false, showCopyright:false});
        currentProb.draw(board);

        if(window.MathJax) MathJax.typesetPromise();
    }

    function showAnswer() {
        document.getElementById('ans-text').innerHTML = "正解：" + currentProb.a;
        document.getElementById('exp-text').innerHTML = "【解説】<br>" + currentProb.e;
        document.getElementById('ans-area').style.display = 'block';
        if(window.MathJax) MathJax.typesetPromise();
    }

    window.onload = nextProblem;
</script>
</body>
</html>
