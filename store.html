<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>特訓ストア - ライセンス有効化</title>
    <script src="auth.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 20px; background: #fdf6e3; line-height: 1.5; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; border-top: 6px solid #268bd2; }
        .pkg-list { font-size: 0.9em; color: #555; background: #eee; padding: 10px; border-radius: 8px; height: 120px; overflow-y: scroll; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #268bd2; color: white; cursor: pointer; font-weight: bold; }
        input[type="text"], input[type="number"] { width: calc(100% - 24px); padding: 12px; margin: 10px 0; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        .price-display { font-size: 1.2em; font-weight: bold; color: #859900; margin: 10px 0; }
        .back-link { display: block; text-align: center; margin-bottom: 15px; text-decoration: none; color: #268bd2; font-weight: bold; }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← メニューに戻る</a>
    <h1>教材ストア</h1>

    <div class="card">
        <h2>ライセンスキー入力</h2>
        <p style="font-size: 0.8em; color: #666;">購入したキーを入力して全機能を解放します。</p>
        <input type="text" id="key-input" placeholder="ライセンスキーを入力">
        <button onclick="applyKey()" class="action-btn">有効化する</button>
        <div id="status-msg" style="margin-top: 10px; font-weight: bold; text-align: center;"></div>
    </div>

    <div style="background: #eee8d5; padding: 25px; border-radius: 12px; margin-top: 20px; border: 1px solid #93a1a1;">
    <h3 style="margin-top:0; color: #073642;">ご利用料金シミュレーター</h3>
    
    <label><strong>1. 利用プラン・パックの選択</strong></label><br>
    <select id="pack-select" style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc;">
        <optgroup label="【個人利用】（即時利用可能）">
            <option value="500">個人：大問別 1カテゴリ (¥500)</option>
            <option value="3500">個人：全問フルパック (¥3,500)</option>
        </optgroup>
        <optgroup label="【団体・法人利用】（要ライセンス発行）">
            <option value="300">団体：大問1 各パック (1名 ¥300)</option>
            <option value="2000">団体：大問1 フルセット (1名 ¥2,000)</option>
            <option value="3500">団体：全問オールインワン (1名 ¥3,500)</option>
        </optgroup>
    </select>

    <label><strong>2. 利用人数を入力</strong></label><br>
    <input type="number" id="student-count" value="1" min="1" 
           style="width: 100%; padding: 12px; margin: 10px 0; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box;">
    <p style="font-size: 0.8rem; color: #657b83;">※団体利用（10名〜）は自動的に団体割引が適用されます。</p>

    <hr style="border: 0; border-top: 1px solid #93a1a1; margin: 20px 0;">

    <div style="text-align: right; font-weight: bold; background: white; padding: 15px; border-radius: 8px;">
        <p id="discount-msg" style="color: #d33682; font-size: 0.9rem; margin: 0;"></p>
        <p style="margin: 5px 0;">1名あたりの単価: <span id="unit-price">¥0</span></p>
        <p style="font-size: 1.4rem; color: #268bd2; margin: 0;">
            合計推定金額: <span id="total-price">¥0</span>
        </p>
    </div>
    
    <button onclick="requestQuote()" style="width: 100%; background: #859900; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 15px; font-size: 1.1rem;">
        この内容で利用・見積もりを相談する
    </button>
</div>

<script>
    function calculate() {
        const packSelect = document.getElementById('pack-select');
        const studentInput = document.getElementById('student-count');
        
        let unit = parseInt(packSelect.value);
        let count = parseInt(studentInput.value) || 0;
        let discount = 1.0;
        let msg = "";

        // 割引ロジック: 10名以上で10%OFF、30名以上で20%OFF
        if (count >= 30) {
            discount = 0.8;
            msg = "【団体割引】30名以上特典 20% OFF 適用！";
        } else if (count >= 10) {
            discount = 0.9;
            msg = "【団体割引】10名以上特典 10% OFF 適用！";
        }

        const total = Math.floor(unit * count * discount);

        document.getElementById('discount-msg').innerText = msg;
        document.getElementById('unit-price').innerText = `¥${unit.toLocaleString()}`;
        document.getElementById('total-price').innerText = `¥${total.toLocaleString()}`;
    }
    // イベント登録
    document.getElementById('pack-select').onchange = calculate;
    document.getElementById('student-count').oninput = calculate;
    calculate(); // 初期計算
</script>
</body>
</html>
