<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問4 平面図形</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fff5f5; }
        .back-link { text-decoration: none; color: #FF3B30; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #FF3B30; }
        #prob-text { font-size: 1.1em; line-height: 1.6; margin: 10px 0; min-height: 60px; font-weight: bold; }
        .jxgbox { width: 100%; height: 350px; margin: 15px 0; border-radius: 10px; background: white; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #FF3B30; color: white; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .ans-box { display: none; margin-top: 15px; padding: 15px; background: #fff0f0; border-radius: 10px; border: 2px solid #FF3B30; }
        .hint-badge { display: inline-block; background: #FF9500; color: white; padding: 2px 8px; border-radius: 5px; font-size: 0.8em; margin-bottom: 5px; }
    </style>
</head>
<body>

<a href="index.html" class="back-link">← メニューに戻る</a>

<div class="card">
    <div class="hint-badge">図の点を動かして考えてみよう！</div>
    <div id="prob-text">問題読み込み中...</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()">答え合わせ</button>
    <button class="action-btn" style="background:#8E8E93;" onclick="loadProblem()">次の問題</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.3em; color:#FF3B30; border-bottom:1px solid #ccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.7; margin-top: 10px;"></div>
    </div>
</div>

<script>
let board = null;

const database = [
    {
        text: String.raw`円Oの周上に3点A, B, Cがあり、$\angle BOC = 80^{\circ}$ です。$\angle BAC$ の大きさを求めなさい。`,
        ans: String.raw`$40^{\circ}$`,
        exp: String.raw`円周角の定理より、同じ弧に対する円周角は中心角の半分です。$80 \div 2 = 40^{\circ}$。`,
        draw: (brd) => {
            let o = brd.create('point', [0,0], {name:'O', fixed:true});
            let c1 = brd.create('circle', [o, 3], {strokeColor:'#ccc'});
            let b = brd.create('point', [3,0], {name:'B', fixed:true});
            let c = brd.create('point', [3*Math.cos(80*Math.PI/180), 3*Math.sin(80*Math.PI/180)], {name:'C', fixed:true});
            let a = brd.create('glider', [-2, 2.2, c1], {name:'A'});
            brd.create('polygon', [o, b, c], {fillColor:'#FF3B30', fillOpacity:0.1});
            brd.create('segment', [a, b]); brd.create('segment', [a, c]);
            brd.create('angle', [b, a, c], {radius:0.7, name:''});
            brd.create('angle', [b, o, c], {radius:0.5, name:'80°'});
        }
    },
    {
        text: String.raw`右の図で、$l // m$ のとき、$\angle x$ の大きさを求めなさい。`,
        ans: String.raw`$60^{\circ}$`,
        exp: String.raw`平行線の錯角を利用します。折れ曲がった点を通る平行な補助線を引くと、$25 + 35 = 60^{\circ}$ となります。`,
        draw: (brd) => {
            brd.create('line', [[-3,2], [3,2]], {name:'l', withLabel:true, fixed:true});
            brd.create('line', [[-3,-2], [3,-2]], {name:'m', withLabel:true, fixed:true});
            let p1 = brd.create('point', [-1, 2], {visible:false});
            let p2 = brd.create('point', [1, 0], {name:'P'});
            let p3 = brd.create('point', [-1, -2], {visible:false});
            brd.create('segment', [p1, p2]); brd.create('segment', [p2, p3]);
            brd.create('text', [-0.5, 1.5, "25°"]);
            brd.create('text', [-0.5, -1.5, "35°"]);
            brd.create('text', [0.3, 0, "x"]);
        }
    }
];

function loadProblem() {
    const q = database[Math.floor(Math.random() * database.length)];
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    
    if(board) JXG.JSXGraph.freeBoard(board);
    board = JXG.JSXGraph.initBoard('jxgbox', {boundingbox: [-4, 4, 4, -4], axis:false, showCopyright:false});
    q.draw(board);
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
}

window.onload = loadProblem;
</script>
</body>
</html>
