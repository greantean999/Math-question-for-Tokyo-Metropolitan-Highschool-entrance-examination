<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>都立数学特訓 - 大問5 空間図形</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraph.css" />
    <script src="https://cdn.jsdelivr.net/npm/jsxgraph/distrib/jsxgraphcore.js"></script>
    <script>window.MathJax = { tex: { inlineMath: [['$', '$']] } };</script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { font-family: sans-serif; max-width: 600px; margin: auto; padding: 10px; background: #fdf6e3; }
        .back-link { text-decoration: none; color: #859900; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid #859900; }
        #prob-text { font-size: 1.1em; line-height: 1.6; margin: 10px 0; min-height: 60px; font-weight: bold; }
        .jxgbox { width: 100%; height: 400px; margin: 15px 0; border-radius: 10px; background: white; }
        .action-btn { width: 100%; padding: 15px; font-size: 18px; border-radius: 12px; border: none; background: #859900; color: white; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        .ans-box { display: none; margin-top: 15px; padding: 15px; background: #f9fdf0; border-radius: 10px; border: 2px solid #859900; }
        .hint-badge { display: inline-block; background: #268bd2; color: white; padding: 2px 8px; border-radius: 5px; font-size: 0.8em; margin-bottom: 5px; }
    </style>
</head>
<body>

<a href="index.html" class="back-link">← メニューに戻る</a>

<div class="card">
    <div class="hint-badge">図形をドラッグして回転させてみよう！</div>
    <div id="prob-text">問題読み込み中...</div>
    <div id="jxgbox" class="jxgbox"></div>
    <button id="show-btn" class="action-btn" onclick="showAnswer()">答え合わせ</button>
    <button class="action-btn" style="background:#8E8E93;" onclick="loadProblem()">次の問題</button>
    
    <div id="ans-area" class="ans-box">
        <div id="ans" style="font-weight:bold; font-size:1.3em; color:#859900; border-bottom:1px solid #ccc; padding-bottom:5px;"></div>
        <div id="exp" style="font-size: 0.95em; color: #444; line-height: 1.7; margin-top: 10px;"></div>
    </div>
</div>

<script>
let board = null;

const database = [
    {
        text: String.raw`1辺が $6\text{cm}$ の正立方体があります。この立方体の体積を求めなさい。`,
        ans: String.raw`$216\text{cm}^3$`,
        exp: String.raw`立方体の体積は「1辺 $\times$ 1辺 $\times$ 1辺」です。$6 \times 6 \times 6 = 216$。`,
        draw: (view) => {
            // 立方体の頂点定義
            let p = [];
            p.push(view.create('point3d', [0, 0, 0], {name:'A', size:2}));
            p.push(view.create('point3d', [3, 0, 0], {name:'B', size:2}));
            p.push(view.create('point3d', [3, 3, 0], {name:'C', size:2}));
            p.push(view.create('point3d', [0, 3, 0], {name:'D', size:2}));
            p.push(view.create('point3d', [0, 0, 3], {name:'E', size:2}));
            p.push(view.create('point3d', [3, 0, 3], {name:'F', size:2}));
            p.push(view.create('point3d', [3, 3, 3], {name:'G', size:2}));
            p.push(view.create('point3d', [0, 3, 3], {name:'H', size:2}));
            
            // 面の作成
            view.create('polygon3d', [p[0], p[1], p[2], p[3]], {fillColor:'#859900', fillOpacity:0.1});
            view.create('polygon3d', [p[4], p[5], p[6], p[7]], {fillColor:'#859900', fillOpacity:0.1});
            view.create('polygon3d', [p[0], p[1], p[5], p[4]], {fillColor:'#859900', fillOpacity:0.1});
            view.create('polygon3d', [p[2], p[3], p[7], p[6]], {fillColor:'#859900', fillOpacity:0.1});
        }
    },
    {
        text: String.raw`底面が1辺 $4\text{cm}$ の正方形で、高さが $6\text{cm}$ の正四角錐の体積を求めなさい。`,
        ans: String.raw`$32\text{cm}^3$`,
        exp: String.raw`錐体の体積は「底面積 $\times$ 高さ $\div 3$」です。$(4 \times 4) \times 6 \div 3 = 32$。`,
        draw: (view) => {
            let p = [];
            p.push(view.create('point3d', [-2, -2, 0], {name:'A'}));
            p.push(view.create('point3d', [2, -2, 0], {name:'B'}));
            p.push(view.create('point3d', [2, 2, 0], {name:'C'}));
            p.push(view.create('point3d', [-2, 2, 0], {name:'D'}));
            let top = view.create('point3d', [0, 0, 4], {name:'V'});
            
            view.create('polygon3d', [p[0], p[1], p[2], p[3]], {fillColor:'#268bd2', fillOpacity:0.1});
            view.create('polygon3d', [p[0], p[1], top], {fillColor:'#268bd2', fillOpacity:0.2});
            view.create('polygon3d', [p[1], p[2], top], {fillColor:'#268bd2', fillOpacity:0.2});
            view.create('polygon3d', [p[2], p[3], top], {fillColor:'#268bd2', fillOpacity:0.2});
            view.create('polygon3d', [p[3], p[0], top], {fillColor:'#268bd2', fillOpacity:0.2});
        }
    }
];

function loadProblem() {
    const q = database[Math.floor(Math.random() * database.length)];
    document.getElementById('prob-text').innerHTML = q.text;
    document.getElementById('ans').innerHTML = "正解：" + q.ans;
    document.getElementById('exp').innerHTML = "【解説】<br>" + q.exp;
    document.getElementById('ans-area').style.display = 'none';
    
    if(board) JXG.JSXGraph.freeBoard(board);
    
    // 3D用のボード初期化
    board = JXG.JSXGraph.initBoard('jxgbox', {
        boundingbox: [-5, 5, 5, -5], 
        keepaspectratio: false, 
        axis: false, 
        showCopyright: false
    });

    let view = board.create('view3d', [[-3, -1], [6, 6], [[-4, 4], [-4, 4], [-4, 4]]], {});
    q.draw(view);
    
    MathJax.typesetPromise();
}

function showAnswer() {
    document.getElementById('ans-area').style.display = 'block';
}

window.onload = loadProblem;
</script>
</body>
</html>
